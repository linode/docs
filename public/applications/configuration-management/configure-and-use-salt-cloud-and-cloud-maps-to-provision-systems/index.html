<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Configure and Use Salt Cloud and Cloud Maps to Provision Systems</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="description" content="This guide shows how to install, configure, and use Salt Cloud to provision multiple Linodes from the command line.">
        <meta name="keywords" content="SaltStack, Salt, salt-cloud">
        
        <meta property="og:title" content="Configure and Use Salt Cloud and Cloud Maps to Provision Systems">
        <meta property="og:type" content="article">
        <meta property="og:url" content="https://linode.com/docs/applications/configuration-management/configure-and-use-salt-cloud-and-cloud-maps-to-provision-systems/">
        <meta property="og:description" content="Salt Cloud is a part of the SaltStack that makes provisioning multiple cloud systems easy. Use our guide to create, manage, and map your own Salt Cloud.">
        <meta property="og:site_name" content="Linode Guides &amp; Tutorials">
        
        
        <meta name="twitter:card" content="summary">
        
        <meta name="twitter:site" content="@linode">
        <link rel="alternate" type="application/rss" href="https://linode.com/docs/index.xml">

        
             <link href="/docs/build/stylesheets/home.css" rel='stylesheet' type='text/css'>

        
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
        <link rel="canonical" href="https://linode.com/docs/applications/configuration-management/configure-and-use-salt-cloud-and-cloud-maps-to-provision-systems/">
        <link rel="shortcut icon" href="/favicon.ico">
    </head>
    <body class="no-subnav">
         <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="searchLabel" id="ds-search-modal">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div id="ds-search-input">
				<div class="input-group col-md-12">
					<input id="ds-search" type="text" class="form-control input-lg" placeholder="Search" />
					<span class="input-group-btn">
						<button class="btn btn-info btn-lg" id="ds-search-btn-modal" type="button">
						<i class="glyphicon glyphicon-search"></i>
						</button>
					</span>
				</div>
				<ul class="list-group" id="ds-search-list">
				</ul>
			</div>
		</div>
	</div>
</div> 
         
        <header>
            <nav id="main-nav" class="navbar navbar-default" role="navigation">
  <div class="container">

    <div class="navbar-header">
      <button type="button" class="toggle navbar-toggle" data-toggle="collapse" data-target=".navbar-top-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="https://www.linode.com"><img id="navbar-logo" src="/docs/media/images/header/linode-logo.svg" style="height:57px"></a>
    </div>

    <div class="collapse navbar-collapse navbar-top-collapse">
      <ul class="nav navbar-nav navbar-right">

                <li><a href="https://www.linode.com/"><span class='nav-home'></span></a></li>
                <li><a href="https://www.linode.com/linodes">Features</a></li>
                <li><a href="https://www.linode.com/pricing">Pricing</a></li>
                <li><a href="https://www.linode.com/addons">Add-ons</a></li>

        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Resources <span class="caret"></span></a>
          <ul class="dropdown-menu dropdown-main-nav dropdown-mega">
            <li class="dropdown-third">
              <ul >
                <li><a href="https://linode.com/docs/getting-started">Getting Started</a></li>
                <li><a href="https://linode.com/docs/migrate-from-shared">Migrating to Linode</a></li>
                <li><a href="https://linode.com/docs/hosting-website">Hosting a Website</a></li>
                <li class="divider"></li>
                <li class="big"><a href="https://linode.com/docs"><i class="fa fa-book"></i> Guides &amp; Tutorials</a></li>
                <li class="divider visible-xs"></li>
              </ul>
            </li>
            <li class="dropdown-third middle">
              <ul >
                <li><a href="https://www.linode.com/api">API</a></li>
                <li><a href="https://www.linode.com/stackscripts">StackScripts</a></li>
                <li><a href="https://www.linode.com/mobile">Mobile</a></li>
                <li><a href="https://www.linode.com/cli" target="_blank">CLI</a></li>

                <li class="divider"></li>

                <li><a href="https://www.linode.com/chat"><i class="fa fa-bullhorn gray"></i> Chat</a></li>
                <li><a href="https://forum.linode.com"><i class="fa fa-comments"></i> Community Forum</a></li>
                <li class="divider visible-xs"></li>
              </ul>
            </li>
            <li class="dropdown-third">
              <ul >
                <li><a href="https://blog.linode.com">Blog</a></li>
                <li><a href="http://status.linode.com">System Status</a></li>
                <li><a href="https://www.linode.com/speedtest">Speed Test</a></li>
                <li><a href="https://www.linode.com/about">About Us</a></li>
                <li class="divider"></li>
                <li><a href="https://www.linode.com/contact"><i class="fa fa-user"></i> Contact Support</a></li>
              </ul>
            </li>
          </ul>
        </li>

        <li role="presentation" class="divider-vertical"><span>|</span></li>
          <li class=""><a href="https://manager.linode.com/">Log in <span class="login-caret"></span></a></li>
          <li class="visible-xs"><a href="https://manager.linode.com/session/signup">Sign up</a></li>
          <li class="hidden-xs"><div><a id="btn-signup-top" class="btn btn-sm btn-green navbar-btn hidden-xs" href="https://manager.linode.com/session/signup">Sign up</a></div></li>
      </ul>
    </div>

  </div>
</nav>

            <nav class="navbar subnav jumbotron" role="navigation">
  <div class="container">
    <div class="subnav-divider">

    </div>
  </div>
</nav>
        </header>
        
<section class="primary first-section">
  <div class="container">
    <div class="row breadcrumb-row">
  <div class="col-sm-12">
    <ol class="breadcrumb library-breadcrumb">
      







<li>
  
  <a href="https://linode.com/docs/">Guides &amp; Tutorials</a>
  
</li>


<li>
  
  <a href="https://linode.com/docs/applications/">Applications</a>
  
</li>


<li>
  
  <a href="https://linode.com/docs/applications/configuration-management/">Configuration Management</a>
  
</li>


<li>
  
  Configure and Use Salt Cloud and Cloud Maps to Provision Systems
  
</li>

    </ol>
  </div>
</div>

    <div class="row" itemscope itemtype="http://schema.org/TechArticle">
      <div class="col-sm-12">
        <div class="row">
          <div class="col-sm-9 col-sm-offset-3">
          </div>
        </div>
        <div class="row">
          <div id="article-body" class="col-sm-9 col-sm-push-3 doc">
            <h1 class="doc-title" itemprop="headline">Configure and Use Salt Cloud and Cloud Maps to Provision Systems</h1>
<p markdown="0" class="doc-time doc-modified-time">
  <small class="updated">Updated <time itemprop="dateModified" datetime="2017-11-01T00:00:00Z">Wednesday, November 1, 2017</time> by Linode</small>
  
  <small class="contributed-by">Contributed by
  
  Sergey Bulavintsev
  
  </small>
  
</p>

           <div class="row">
            <div class="col-sm-9"><div markdown="0" class="signup-top">
    <span>
        Use promo code <strong>DOCS10</strong> for $10 credit on a new account.
    </span>
    <form action="https://manager.linode.com/session/signup" style="display: inline">
        <button type="submit" target="_blank" class="btn btn-blue btn-sm btn-border">Try this Guide</button>
    </form>
</div>
</div>
            <div class="col-sm-3"><div class="social-share">
    <div class="btn-group share-group">
        <a data-toggle="dropdown" class="btn btn-info">
            <i class="fa fa-share-alt fa-inverse"></i>
        </a>
        <button href="#" data-toggle="dropdown" class="btn btn-info dropdown-toggle share">
        <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li>
                <a data-original-title="Twitter" rel="tooltip"  href="https://twitter.com/share?url=https%3a%2f%2flinode.com%2fdocs%2fapplications%2fconfiguration-management%2fconfigure-and-use-salt-cloud-and-cloud-maps-to-provision-systems%2f&via=linode&text=Configure%20and%20Use%20Salt%20Cloud%20%e2%80%a6" class="btn btn-twitter" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-twitter"></i>
                </a>
            </li>
            <li>
                <a data-original-title="Facebook" rel="tooltip"  href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flinode.com%2fdocs%2fapplications%2fconfiguration-management%2fconfigure-and-use-salt-cloud-and-cloud-maps-to-provision-systems%2f" class="btn btn-facebook" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-facebook"></i>
                </a>
            </li>
            <li>
                <a data-original-title="Hacker News" rel="tooltip"  href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flinode.com%2fdocs%2fapplications%2fconfiguration-management%2fconfigure-and-use-salt-cloud-and-cloud-maps-to-provision-systems%2f&t=Configure%20and%20Use%20Salt%20Cloud%20and%20Cloud%20Maps%20to%20Provision%20Systems" class="btn btn-hacker-news" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-hacker-news "></i>
                </a>
            </li>
        </ul>
    </div>
</div></div>
            </div>
            <div class="library-github" markdown="0">
	<i class="fa fa-github"></i>
	<strong>Contribute on GitHub</strong>
	<p>
		
		<a href="https://github.com/linode/docs">View Project</a> |
		<a href="https://github.com/linode/docs/blob/master/docs/applications/configuration-management/configure-and-use-salt-cloud-and-cloud-maps-to-provision-systems.md">View File</a> |
		<a href="https://github.com/linode/docs/edit/master/docs/applications/configuration-management/configure-and-use-salt-cloud-and-cloud-maps-to-provision-systems.md">Edit File</a>
	</p>
</div>
            <hr />

<p><em>This is a Linode Community guide. If you&rsquo;re an expert on something for which we need a guide, you too can <a href="/docs/contribute">get paid to write for us.</a></em></p>

<hr />

            

            

<p><img src="/docs/assets/saltcloud/SaltCloud.jpg" alt="Salt Cloud" /></p>

<h2 id="what-is-salt-cloud">What is Salt Cloud?</h2>

<p><a href="https://docs.saltstack.com/en/latest/topics/cloud/">Salt Cloud</a> is a configuration management tool that allows users to provision systems on cloud hosts or hypervisors. During installation, Salt Cloud installs Salt on all provisioned systems by default. This enables the user to put systems into the desired state during provisioning.</p>

<p>Salt Cloud:</p>

<ul>
<li>Helps gather information on your systems and manage their lifecycle through a Command Line Interface (CLI).</li>
<li>Supports Linode as a provider out of the box. You do not have to install any additional plugins.</li>
</ul>

<p>This guide shows how to install Salt Cloud and configure it to work on a Linode.</p>

<h2 id="before-you-begin">Before You Begin</h2>

<ol>
<li><p>Create a management server which will be used to create and manage your Linode servers. You can host the management server remotely on a Linode, or on a local machine. The only condition is that it is capable of installing and executing Salt Cloud.</p></li>

<li><p>This guide assumes that Salt Cloud will be installed together with Salt master server.</p></li>

<li><p>Generate an <a href="/docs/platform/api/api-key">API key</a> to access Linode API. This key will be used by Salt Cloud to manage your instances. Make sure to keep your API key safe.</p></li>

<li><p>The management server must have access to the Linode API (non-proxy internet access).</p></li>
</ol>

<h2 id="install-salt-and-salt-cloud-via-bootstrap-script">Install Salt and Salt Cloud via Bootstrap Script</h2>

<p>The recommended way to install Salt Cloud is with a Salt Bootstrap script. This script will install Salt, Salt Cloud packages, and all required dependencies. Run the script with the <code>-h</code> flag to view the additional options available, or refer to <a href="https://docs.saltstack.com/en/latest/topics/tutorials/salt_bootstrap.html">Salt Bootstrap Guide</a> for detailed instructions.</p>

<ol>
<li><p>Download the Salt Bootstrap script via curl:</p>

<pre><code>curl -o bootstrap-salt.sh -L https://bootstrap.saltstack.com
</code></pre></li>

<li><p>Execute the script and use the <code>-L</code> option to install Salt and Salt Cloud:</p>

<pre><code>sh bootstrap-salt.sh -L
</code></pre></li>
</ol>

<h2 id="configure-salt-cloud">Configure Salt Cloud</h2>

<h3 id="set-up-provider-configuration">Set up Provider Configuration:</h3>

<p>Configure and test access to the Linode API.</p>

<ol>
<li><p>Edit <code>/etc/salt/cloud.providers.d/linode.conf</code> to configure the name of your provider configuration. Salt Cloud will use it during operations with instances in the CLI. Use a short name (or abbreviation like <code>li</code>) that will be easy to remember. You can also specify multiple Linode providers for managing multiple accounts. Linode requires the default root password for the new servers to be set. This password needs to be eight characters and contain lowercase, uppercase, and numbers.</p>

<dl class="file-excerpt">
<dt>


		/etc/salt/cloud.providers.d/linode.conf 


</dt>
<dd>







<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-conf" data-lang="conf"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-conf" data-lang="conf">linode-provider:
    apikey: &lt;Your API key&gt;
    password: &lt;Default password for the new instances&gt;
        driver: linode</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<blockquote class="note">
  <strong class="callout-title">Note</strong>
  <div>All configuration files store data in YAML format. Be careful with indentation - use only spaces and not tabs. Each level of indentation is usually separated with 2 spaces.</div>
</blockquote>
</li>

<li><p>Test access to the Linode API:</p>

<p>Execute the following command from your master to test access to the Linode API:</p>

<pre><code>salt-cloud --list-locations linode-provider
</code></pre>

<p>If you have set up the connection to Linode properly, you will see output similar to:</p>

<pre><code>linode_provider:
    ----------
    linode:
        ----------
        Atlanta, GA, USA:
            ----------
            ABBR:
                atlanta
            DATACENTERID:
                4
            LOCATION:
                Atlanta, GA, USA
</code></pre></li>
</ol>

<h2 id="create-a-new-salt-cloud-instance">Create a New Salt Cloud Instance</h2>

<h3 id="list-available-locations-images-and-sizes">List Available Locations, Images and Sizes</h3>

<p>Before creating new instances, specify instance size: amount of system memory, CPU, and storage; location: physical location of datacenter; and image: operating system.</p>

<p>You can obtain this information with the following commands:</p>

<ul>
<li><p>Available locations:</p>

<pre><code>salt-cloud --list-locations linode-provider
</code></pre></li>

<li><p>Available sizes:</p>

<pre><code>salt-cloud --list-sizes linode-provider
</code></pre></li>

<li><p>Available images:</p>

<pre><code>salt-cloud --list-images linode-provider
</code></pre></li>
</ul>

<h3 id="set-up-profile-configuration">Set up Profile Configuration</h3>

<p>Create an instance profile. In this profile you describe a server which will be created on your Linode account. Minimal configuration should include provider, size, image and location.</p>

<p>For this example, create an instance with minimal size, using a CentOS 7 image, located in London.</p>

<ol>
<li><p>Open <code>/etc/salt/cloud.profiles.d/linode-london-1024.conf</code> and paste the following:</p>

<dl class="file-excerpt">
<dt>


		/etc/salt/cloud.profiles.d/linode-london-1024.conf 


</dt>
<dd>







<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-conf" data-lang="conf"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span><span class="lnt">5</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-conf" data-lang="conf">linode_1024:
    provider: linode-provider
    size: Linode 1024
    image: CentOS 7
    location: London, England, UK</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<p>You can use one file for all profiles, or use one file per instance profile. All files from <code>/etc/salt/cloud.profiles.d/</code> are read during execution.</p></li>

<li><p>By default, Salt Cloud will install Salt Minion on all provisioned servers. To allow provisioned systems to connect to the master, set the default master configuration for all provisioned systems.</p>

<p>Edit <code>/etc/salt/cloud.conf.d/master.conf</code> and paste the following content, replacing <code>saltmaster.example.com</code> with the IP address or domain name of your master server:</p>

<dl class="file-excerpt">
<dt>


		/etc/salt/cloud.conf.d/master.conf 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span><span class="lnt">2</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">minion:
    master: saltmaster.example.com</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<p>Another option is to set this parameter for specific instance profile:</p>

<dl class="file-excerpt">
<dt>


		/etc/salt/cloud.profiles.d/linode-london-1024.conf 


</dt>
<dd>







<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-conf" data-lang="conf"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span><span class="lnt">5</span><span class="lnt">6</span><span class="lnt">7</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-conf" data-lang="conf">linode_1024_with_master:
provider: linode-provider
    size: Linode 1024
    image: CentOS 7
    location: London, England, UK
    minion:
        master: mymaster.example.com</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>
</li>

<li><p>Set up <a href="/docs/security/use-public-key-authentication-with-ssh">SSH key authentication</a> for your instance. To do this during provisioning, set up the profile as follows, replacing the <code>ssh_pubkey</code> and <code>ssh_key_file</code> with key information for an SSH key on your master server:</p>

<dl class="file-excerpt">
<dt>


		/etc/salt/cloud.profiles.d/linode-london-1024.conf 


</dt>
<dd>







<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-conf" data-lang="conf"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span><span class="lnt">5</span><span class="lnt">6</span><span class="lnt">7</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-conf" data-lang="conf">linode_1024_with_ssh_key:
    provider: linode-provider
    size: Linode 1024
    image: CentOS 7
    location: London, England, UK
    ssh_pubkey: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKHEOLLbeXgaqRQT9NBAopVz366SdYc0KKX33vAnq+2R user@host
    ssh_key_file: ~/.ssh/id_ed25519</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<blockquote class="note">
  <strong class="callout-title">Note</strong>
  <div>If your master server is located behind a firewall, you will have to open ports <code>4505-4506</code> in <a href="https://docs.saltstack.com/en/latest/topics/tutorials/firewall.html">firewall</a>. Depending on your network configuration, you may have to set up port forwarding for these ports.</div>
</blockquote>
</li>
</ol>

<h2 id="salt-cloud-interface">Salt Cloud Interface</h2>

<h3 id="create-linode-instances">Create Linode Instances</h3>

<p>There are several ways to create new instances:</p>

<ul>
<li><p><strong>Create a single new instance</strong>:</p>

<pre><code>salt-cloud -p linode_1024 linode1
</code></pre>

<p>Creating the instance and installing Salt Minion on it might take some time.</p>

<p>When deployment is complete, you will see following summary:</p>

<pre><code>linode1:
    ----------
    deployed:
        True
    id:
        &lt;ID&gt;
    image:
        CentOS 7
    name:
        linode1
    private_ips:
    public_ips:
        - &lt;ip_address&gt;
    size:
        Linode 1024
    state:
        Running
</code></pre></li>

<li><p>You can connect to the instance using user <code>root</code> and the password specified in the config file.</p></li>

<li><p>To <strong>create multiple servers in one command</strong> type the following:</p>

<pre><code>salt-cloud -p linode_1024 linode1 linode2
</code></pre>

<p>The instance names which you provide in this command are used to manage instances internally and they are not connected to the instance hostname.</p>

<p>Linode labels:</p>

<ul>
<li>May only contain ASCII letters or numbers, dashes, and underscores</li>
<li>Must begin and end with letters or numbers, and</li>
<li>Be at least three characters in length.</li>
</ul></li>

<li><p>Normally when creating instances, they are executed serially. Use the <code>salt-cloud</code> command with <code>-P</code> option to <strong>create instances in parallel allowing for deployment</strong>:</p>

<pre><code>salt-cloud -P -p linode_1024 linode1 linode2
</code></pre></li>

<li><p><strong>If you do not want to install Salt Minion on the provisioned server</strong>, run <code>salt-cloud</code> with the <code>--no-deploy</code> option:</p>

<pre><code>salt-cloud -p linode_1024 --no-deploy linode3
</code></pre>

<p>Salt cloud will generate an error message, but the instance will be created:</p>

<pre><code>linode3:
    ----------
    Error:
        ----------
        No Deploy:
            'deploy' is not enabled. Not deploying.
</code></pre></li>
</ul>

<h3 id="destroy-salt-cloud-instances">Destroy Salt Cloud Instances</h3>

<ol>
<li><p>To destroy an instance, execute <code>salt-cloud</code> with <code>-d</code> option:</p>

<pre><code>salt-cloud -d linode1
</code></pre></li>

<li><p>The server will be destroyed after you confirm the deletion.</p></li>
</ol>

<h3 id="get-information-about-running-instances">Get Information About Running Instances</h3>

<p><strong>Partial Information</strong></p>

<p>Gather partial information by executing <code>salt-cloud</code> with the <code>-Q</code> option:</p>

<pre><code>salt-cloud -Q
</code></pre>

<p><strong>Full Information</strong></p>

<p>Get full information about instances using <code>-F</code> option:</p>

<pre><code>salt-cloud -F
</code></pre>

<p><strong>Configure a Selective Query</strong></p>

<ol>
<li><p>Edit <code>/etc/salt/cloud.conf.d/query.conf</code> and add the fields you would like to select:</p>

<dl class="file-excerpt">
<dt>


		/etc/salt/cloud.conf.d/query.conf 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">query.selection:
    - image
    - size</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>
</li>

<li><p>Execute selective query using <code>-S</code> option:</p>

<pre><code>salt-cloud -S
</code></pre>

<p>Output:</p>

<pre><code>linode3:
    ----------
    image:
        CentOS
    size:
        1024
</code></pre></li>
</ol>

<h2 id="how-to-perform-actions-on-salt-cloud-instances">How to Perform Actions on Salt Cloud Instances</h2>

<p>Actions are features that apply to a specific instance. Currently, the following actions are supported:</p>

<ul>
<li><code>show_instance</code></li>
<li><code>start</code></li>
<li><code>stop</code></li>
</ul>

<p>For example, to stop a running <code>linode1</code> instance, execute the <code>salt-cloud</code> command with the <code>-a</code> option and <code>stop</code> command:</p>

<pre><code>salt-cloud -a stop linode1
</code></pre>

<h2 id="use-cloud-map-files-to-manage-complex-environments">Use Cloud Map Files to Manage Complex Environments</h2>

<p>Scaling, creating, and destroying servers one at a time can be cumbersome. To alleviate this, use Cloud Map files.</p>

<p>Cloud maps assign profiles to a list of instances. During execution Salt Cloud will try to bring the state of these instances into agreement with the map file. New instances will be created, and existing instances will remain unmodified.</p>

<h3 id="configure-cloud-map">Configure Cloud Map</h3>

<p>In this example, Cloud map will define two instances: <code>linode_web</code> and <code>linode_db</code>. Both instances will use the profile <code>linode_1024</code>, defined earlier.</p>

<ol>
<li><p>Edit <code>/etc/salt/cloud.conf.d/linode.map</code> and paste the following:</p>

<dl class="file-excerpt">
<dt>


		/etc/salt/cloud.conf.d/linode.map 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">linode_1024:
    - linode_web
    - linode_db</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<p>Cloud map file allows you to define instances from several Linode accounts or even from a different provider. Check the <a href="https://docs.saltstack.com/en/latest/topics/cloud/map.html">Cloud Map documentation</a> for an in-depth guide.</p></li>

<li><p>To create instances from the Cloud map file, execute <code>salt-cloud</code> with the <code>-m</code> option and point to the <code>.map</code> file:</p>

<pre><code>salt-cloud -m /etc/salt/cloud.conf.d/linode.map
</code></pre></li>

<li><p>Salt Cloud will ask you to confirm the target configuration:</p>

<pre><code>The following virtual machines are set to be created:
    linode_web
    linode_db

Proceed? [N/y] y
... proceeding
.  .  .
</code></pre>

<p>To create instances in parallel, use <code>-P</code> option with Cloud map files.</p></li>
</ol>

<h3 id="delete-instances-created-by-cloud-map-files">Delete Instances Created by Cloud Map Files</h3>

<p>If an existing instance is removed from the Cloud map file, it will remain running. To delete instances created by map files:</p>

<ul>
<li><p>Delete single or multiple instances, specify their names:</p>

<pre><code>salt-cloud -d linode_web linode_db
</code></pre></li>

<li><p>Delete all instances, described in the <code>map</code> file:</p>

<pre><code>salt-cloud -d -m /etc/salt/cloud.conf.d/linode.map
</code></pre></li>

<li><p>Allow Salt Cloud to destroy every instance not described in the <code>map</code> file. SaltStack considers deleting such instances dangerous. This is disabled by default. To enable it:</p>

<ol>
<li><p>Modify <code>/etc/salt/cloud</code> and add:</p>

<dl class="file-excerpt">
<dt>


		/etc/salt/cloud 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">enable_hard_maps: True</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>
</li>

<li><p>Execute <code>salt-cloud</code> with the <code>--hard</code> option:</p>

<pre><code>salt-cloud -d -m /etc/salt/cloud.maps.d/linode.map
</code></pre></li>

<li><p>Confirm the deletion when prompted.</p></li>
</ol></li>
</ul>

            

            


            
            
<p class="doc-license">This guide is published under a <a href="https://creativecommons.org/licenses/by-nd/4.0">CC BY-ND 4.0</a> license.</p>

          </div>
          <div id="doc-sidebar-container" class="col-sm-3 col-sm-pull-9 hidden-xs">
            <div id="doc-sidebar">
              <div markdown="0" class="doc-sidebar-inner" >
  <div class="input-group">
	<label class="sr-only" for="q">Search guides and tutorials</label>
	<input id="ss_keyword" name="q" type="text" class="form-control" placeholder="Search guides..."/>
	<span class="input-group-btn">
		<button type="submit" class="btn btn-blue" id="ds-search-btn"><span class="glyphicon glyphicon-search"></span></button>
	</span>
</div>
</div>

                
              <div class="doc-sidebar-inner" id="doc-sidebar-toc">
                <h3 id="doc-sidebar-title">In This Guide:</h3>
                <div class="sidebar sidebar-library toc-long nav navbar" id="markdown-toc">
                    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#what-is-salt-cloud">What is Salt Cloud?</a></li>
<li><a href="#before-you-begin">Before You Begin</a></li>
<li><a href="#install-salt-and-salt-cloud-via-bootstrap-script">Install Salt and Salt Cloud via Bootstrap Script</a></li>
<li><a href="#configure-salt-cloud">Configure Salt Cloud</a>
<ul>
<li><a href="#set-up-provider-configuration">Set up Provider Configuration:</a></li>
</ul></li>
<li><a href="#create-a-new-salt-cloud-instance">Create a New Salt Cloud Instance</a>
<ul>
<li><a href="#list-available-locations-images-and-sizes">List Available Locations, Images and Sizes</a></li>
<li><a href="#set-up-profile-configuration">Set up Profile Configuration</a></li>
</ul></li>
<li><a href="#salt-cloud-interface">Salt Cloud Interface</a>
<ul>
<li><a href="#create-linode-instances">Create Linode Instances</a></li>
<li><a href="#destroy-salt-cloud-instances">Destroy Salt Cloud Instances</a></li>
<li><a href="#get-information-about-running-instances">Get Information About Running Instances</a></li>
</ul></li>
<li><a href="#how-to-perform-actions-on-salt-cloud-instances">How to Perform Actions on Salt Cloud Instances</a></li>
<li><a href="#use-cloud-map-files-to-manage-complex-environments">Use Cloud Map Files to Manage Complex Environments</a>
<ul>
<li><a href="#configure-cloud-map">Configure Cloud Map</a></li>
<li><a href="#delete-instances-created-by-cloud-map-files">Delete Instances Created by Cloud Map Files</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
                </div>
              </div>
              
              <div class="library-rss">
  <a href="https://linode.com/docs/index.xml"><i class="fa fa-rss-square"></i> RSS feed</a>
</div>

              <div markdown="0" class="library-signup">
  <form action="//linode.us7.list-manage.com/subscribe/post?u=f9b54ed743e1629877750e3f4&amp;id=68bafea72a&SIGNUP=library-website"
    method="post" class="email-signup" target="_blank" novalidate="">
    <i class="fa fa-envelope"></i>
    <h6>Monthly Guides Update</h6>
    <input name="EMAIL" type="email" class="form-control input-sm"
    placeholder="Email address" required="" />
    <div style="position: absolute; left: -5000px;" aria-hidden="true">
      <input type="text" name="b_f9b54ed743e1629877750e3f4_68bafea72a"
      tabindex="-1" value="">
    </div>
    <div style="display:none">
      <input type="checkbox" value="4" name="group[13][4]"
      id="mce-group[13]-13-0" checked="">
    </div>
    <button type="submit" class="btn btn-blue btn-sm btn-border email-signup" value="Subscribe"
    name="subscribe" id="mc-embedded-subscribe">Sign Up</button>
  </form>
</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<div class="modal fade" id="img-modal" tabindex="-1" role="dialog" aria-labelledby="imageModal" aria-hidden="true">
  <div class="modal-dialog modal-full">
    <div class="modal-content">
      <div class="modal-header">
        <h4 id="img-modal-title" class="modal-title">Image Detail</h4>
      </div>
      <div class="modal-body">
        <img id="img-modal-image" class="img-responsive">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-blue" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

        <footer>
            <section class="neutral some-space">
	<div class="container">
		<div class="row">
			<div class="col-sm-12 text-center">
				<h3>Get paid to write for Linode.</h3>
				<p class="lead">We're always expanding our docs. If you like to help people, can write, and want to earn some cash, learn how you can <a href="/docs/contribute">earn up to $300 for every guide you write</a> and we publish.</p>
			</div>
		</div>
	</div>
</section>
            <section id="pre-footer">
  <div class="container">
    <div class="row">
      <div class="col-sm-7">
        <span>Get started in the Linode Cloud today.</span>
      </div>
      <div class="col-sm-5 pad-xs">
        <a id="btn-signup-bottom" class="btn btn-lg btn-full btn-green" href="https://manager.linode.com/session/signup">Create an Account</a>
      </div>
    </div>
  </div>
</section>

<section class="dark">
  <div class="container">

    <div class="row">
      <div class="footer-col">
        <h5><a href="https://www.linode.com/linodes">Overview</a></h5>
        <ul>
          <li><a href="https://www.linode.com/pricing">Plans &amp; Pricing</a></li>
          <li><a href="https://www.linode.com/linodes">Features</a></li>
          <li><a href="https://www.linode.com/addons">Add-Ons</a></li>
          <li><a href="https://www.linode.com/managed">Managed</a></li>
          <li><a href="https://www.linode.com/professional-services">Professional Services</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h5><a href="https://linode.com/docs/">Resources</a></h5>
        <ul>
          <li><a href="https://linode.com/docs/">Guides &amp; Tutorials</a></li>
          <li><a href="https://www.linode.com/speedtest">Speed Test</a></li>
          <li><a href="https://forum.linode.com/">Forum</a></li>
          <li><a href="https://www.linode.com/chat">Chat</a></li>
          <li><a href="http://status.linode.com/">System Status</a></li>
        </ul>
      </div>


      <div class="footer-col">
        <h5><a href="https://www.linode.com/about">Company</a></h5>
        <ul>
          <li><a href="https://www.linode.com/about">About Us</a></li>
          <li><a href="https://blog.linode.com">Blog</a></li>
          <li><a href="https://www.linode.com/press">Press</a></li>
          <li><a href="https://www.linode.com/referrals">Referral System</a></li>
          <li><a href="https://www.linode.com/careers">Careers</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h5><a href="https://www.linode.com/contact">Contact Us</a></h5>
        <ul>
          <li><a href="tel:+18554546633">855-4-LINODE</a></li>
          <li><a href="tel:+18554546633">(855-454-6633)</a></li>
          <li><a href="tel:+16093807100">Intl.: +1 609-380-7100</a></li>
          <li><a href="mailto:support@linode.com">Email us</a></li>
          <li>
            <br />
            <a target="_blank" href="https://facebook.com/linode"><i class="fa fa-facebook-square"></i></a>
            <a target="_blank" href="https://twitter.com/linode"><i class="fa fa-twitter-square"></i></a>
            <a target="_blank" href="https://plus.google.com/+linode/"><i class="fa fa-google-plus-square"></i></a>
            <a target="_blank" href="https://linkedin.com/company/linode"><i class="fa fa-linkedin-square"></i></a>
            <a target="_blank" href="https://github.com/linode/"><i class="fa fa-github-square"></i></a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</section>

<section class="dark-moar">
  <div class="container">
    <div id="footer-copyright" class="row">
      <div class="col text-center">
        &copy; 2017 Linode, LLC
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/tos">Terms of Service</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/privacy">Privacy Policy</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/security">Security</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/compliance">Standards &amp; Compliance</a>
      </div>
    </div>
  </div>
</section>

        </footer>
        
             <script src="/docs/build/js/libs.js" type="text/javascript"></script>
<script src="/docs/build/js/main.js" type="text/javascript"></script>

        
        <script type="text/javascript">
$( "img[src^='\/docs\/assets']" ).each(function () {
  $( this ).parent().bind('click', false);
  $( this ).on('click', function(e) {
    var image_title = $( this ).attr('alt');
    var image_href = $( this ).parent().attr('href') || $( this ).attr('src');
    $( '#img-modal-image' ).attr('src', image_href);
    $( '#img-modal-title' ).text(image_title);
    $( '#img-modal' ).modal({ show: true });
  });
});
</script>



        
<script type="text/javascript">
 SidebarScroll.init()
</script>

    </body>
</html>