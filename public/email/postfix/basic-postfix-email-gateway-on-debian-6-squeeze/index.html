<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Basic Postfix Email Gateway on Debian 6 (Squeeze)</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="description" content="Configure the Postfix MTA as a basic email gateway.">
        <meta name="keywords" content="email, postfix, mta, forwarding, ">
        
        <meta property="og:title" content="Basic Postfix Email Gateway on Debian 6 (Squeeze)">
        <meta property="og:type" content="article">
        <meta property="og:url" content="https://linode.com/docs/email/postfix/basic-postfix-email-gateway-on-debian-6-squeeze/">
        <meta property="og:description" content="Configure the Postfix MTA as a basic email gateway.">
        <meta property="og:site_name" content="Linode Guides &amp; Tutorials">
        
        
        <meta name="twitter:card" content="summary">
        
        <meta name="twitter:site" content="@linode">
        <link rel="alternate" type="application/rss" href="https://linode.com/docs/index.xml">

        
             <link href="/docs/build/stylesheets/home.css" rel='stylesheet' type='text/css'>

        
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
        <link rel="canonical" href="https://linode.com/docs/email/postfix/basic-postfix-email-gateway-on-debian-6-squeeze/">
        <link rel="shortcut icon" href="/favicon.ico">
    </head>
    <body class="no-subnav">
         <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="searchLabel" id="ds-search-modal">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div id="ds-search-input">
				<div class="input-group col-md-12">
					<input id="ds-search" type="text" class="form-control input-lg" placeholder="Search" />
					<span class="input-group-btn">
						<button class="btn btn-info btn-lg" id="ds-search-btn-modal" type="button">
						<i class="glyphicon glyphicon-search"></i>
						</button>
					</span>
				</div>
				<ul class="list-group" id="ds-search-list">
				</ul>
			</div>
		</div>
	</div>
</div> 
         
        <header>
            <nav id="main-nav" class="navbar navbar-default" role="navigation">
  <div class="container">

    <div class="navbar-header">
      <button type="button" class="toggle navbar-toggle" data-toggle="collapse" data-target=".navbar-top-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="https://www.linode.com"><img id="navbar-logo" src="/docs/media/images/header/linode-logo.svg" style="height:57px"></a>
    </div>

    <div class="collapse navbar-collapse navbar-top-collapse">
      <ul class="nav navbar-nav navbar-right">

                <li><a href="https://www.linode.com/"><span class='nav-home'></span></a></li>
                <li><a href="https://www.linode.com/linodes">Features</a></li>
                <li><a href="https://www.linode.com/pricing">Pricing</a></li>
                <li><a href="https://www.linode.com/addons">Add-ons</a></li>

        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Resources <span class="caret"></span></a>
          <ul class="dropdown-menu dropdown-main-nav dropdown-mega">
            <li class="dropdown-third">
              <ul >
                <li><a href="https://linode.com/docs/getting-started">Getting Started</a></li>
                <li><a href="https://linode.com/docs/migrate-from-shared">Migrating to Linode</a></li>
                <li><a href="https://linode.com/docs/hosting-website">Hosting a Website</a></li>
                <li class="divider"></li>
                <li class="big"><a href="https://linode.com/docs"><i class="fa fa-book"></i> Guides &amp; Tutorials</a></li>
                <li class="divider visible-xs"></li>
              </ul>
            </li>
            <li class="dropdown-third middle">
              <ul >
                <li><a href="https://www.linode.com/api">API</a></li>
                <li><a href="https://www.linode.com/stackscripts">StackScripts</a></li>
                <li><a href="https://www.linode.com/mobile">Mobile</a></li>
                <li><a href="https://www.linode.com/cli" target="_blank">CLI</a></li>

                <li class="divider"></li>

                <li><a href="https://www.linode.com/chat"><i class="fa fa-bullhorn gray"></i> Chat</a></li>
                <li><a href="https://forum.linode.com"><i class="fa fa-comments"></i> Community Forum</a></li>
                <li class="divider visible-xs"></li>
              </ul>
            </li>
            <li class="dropdown-third">
              <ul >
                <li><a href="https://blog.linode.com">Blog</a></li>
                <li><a href="http://status.linode.com">System Status</a></li>
                <li><a href="https://www.linode.com/speedtest">Speed Test</a></li>
                <li><a href="https://www.linode.com/about">About Us</a></li>
                <li class="divider"></li>
                <li><a href="https://www.linode.com/contact"><i class="fa fa-user"></i> Contact Support</a></li>
              </ul>
            </li>
          </ul>
        </li>

        <li role="presentation" class="divider-vertical"><span>|</span></li>
          <li class=""><a href="https://manager.linode.com/">Log in <span class="login-caret"></span></a></li>
          <li class="visible-xs"><a href="https://manager.linode.com/session/signup">Sign up</a></li>
          <li class="hidden-xs"><div><a id="btn-signup-top" class="btn btn-sm btn-green navbar-btn hidden-xs" href="https://manager.linode.com/session/signup">Sign up</a></div></li>
      </ul>
    </div>

  </div>
</nav>

            <nav class="navbar subnav jumbotron" role="navigation">
  <div class="container">
    <div class="subnav-divider">

    </div>
  </div>
</nav>
        </header>
        
<section class="primary first-section">
  <div class="container">
    <div class="row breadcrumb-row">
  <div class="col-sm-12">
    <ol class="breadcrumb library-breadcrumb">
      







<li>
  
  <a href="https://linode.com/docs/">Guides &amp; Tutorials</a>
  
</li>


<li>
  
  <a href="https://linode.com/docs/email/">Email Server Guides</a>
  
</li>


<li>
  
  <a href="https://linode.com/docs/email/postfix/">Postfix</a>
  
</li>


<li>
  
  Basic Postfix Email Gateway on Debian 6 (Squeeze)
  
</li>

    </ol>
  </div>
</div>

    <div class="row" itemscope itemtype="http://schema.org/TechArticle">
      <div class="col-sm-12">
        <div class="row">
          <div class="col-sm-9 col-sm-offset-3">
          </div>
        </div>
        <div class="row">
          <div id="article-body" class="col-sm-9 col-sm-push-3 doc">
            <h1 class="doc-title" itemprop="headline">Basic Postfix Email Gateway on Debian 6 (Squeeze)</h1>
<p markdown="0" class="doc-time doc-modified-time">
  <small class="updated">Updated <time itemprop="dateModified" datetime="2013-09-25T00:00:00Z">Wednesday, September 25, 2013</time> by Linode</small>
  
</p>

           <div class="row">
            <div class="col-sm-9"><div markdown="0" class="signup-top">
    <span>
        Use promo code <strong>DOCS10</strong> for $10 credit on a new account.
    </span>
    <form action="https://manager.linode.com/session/signup" style="display: inline">
        <button type="submit" target="_blank" class="btn btn-blue btn-sm btn-border">Try this Guide</button>
    </form>
</div>
</div>
            <div class="col-sm-3"><div class="social-share">
    <div class="btn-group share-group">
        <a data-toggle="dropdown" class="btn btn-info">
            <i class="fa fa-share-alt fa-inverse"></i>
        </a>
        <button href="#" data-toggle="dropdown" class="btn btn-info dropdown-toggle share">
        <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li>
                <a data-original-title="Twitter" rel="tooltip"  href="https://twitter.com/share?url=https%3a%2f%2flinode.com%2fdocs%2femail%2fpostfix%2fbasic-postfix-email-gateway-on-debian-6-squeeze%2f&via=linode&text=Basic%20Postfix%20Email%20Gateway%20on%20%e2%80%a6" class="btn btn-twitter" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-twitter"></i>
                </a>
            </li>
            <li>
                <a data-original-title="Facebook" rel="tooltip"  href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flinode.com%2fdocs%2femail%2fpostfix%2fbasic-postfix-email-gateway-on-debian-6-squeeze%2f" class="btn btn-facebook" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-facebook"></i>
                </a>
            </li>
            <li>
                <a data-original-title="Hacker News" rel="tooltip"  href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flinode.com%2fdocs%2femail%2fpostfix%2fbasic-postfix-email-gateway-on-debian-6-squeeze%2f&t=Basic%20Postfix%20Email%20Gateway%20on%20Debian%206%20%28Squeeze%29" class="btn btn-hacker-news" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-hacker-news "></i>
                </a>
            </li>
        </ul>
    </div>
</div></div>
            </div>
            <div class="library-github" markdown="0">
	<i class="fa fa-github"></i>
	<strong>Contribute on GitHub</strong>
	<p>
		
		<a href="https://github.com/linode/docs">View Project</a> |
		<a href="https://github.com/linode/docs/blob/master/docs/email/postfix/basic-postfix-email-gateway-on-debian-6-squeeze.md">View File</a> |
		<a href="https://github.com/linode/docs/edit/master/docs/email/postfix/basic-postfix-email-gateway-on-debian-6-squeeze.md">Edit File</a>
	</p>
</div>
            
            
<blockquote class="deprecated">
	<strong class="callout-title">Deprecated</strong>
	<div>This guide has been deprecated and is no longer being maintained.</div>
	<div>
		
	</div>
</blockquote>


            

<p>Postfix is an efficient, stable, and modern &ldquo;Mail Transfer Agent&rdquo; or MTA used for transmitting email messages between severs on the Internet. Most configurations involving Postfix combine the MTA with a server to allow users to download email using a protocol like IMAP or POP3. This document outlines a very simple configuration of Postfix that makes it possible to forward email, and deliver email to local mailboxes on your Linode instance. This guide <em>does not</em> provide any way to download this email or remotely access these mailboxes. In addition, this document provides instructions for sending email with this configuration. If you want to deploy a complete and fully featured email solution that includes the ability download locally delivered email, consider one of our other <a href="/docs/email/postfix/">postfix email guides</a>.</p>

<p>Prior to beginning this document to install a basic Postfix email gateway, we assume that you have completed our <a href="/docs/getting-started/">getting started guide</a>. If you are new to Linux server administration, you may be interested in our <a href="/docs/tools-reference/introduction-to-linux-concepts/">introduction to Linux concepts guide</a>, <a href="/docs/beginners-guide/">beginner&rsquo;s guide</a> and <a href="/content/using-linux/administration-basics">administration basics guide</a>.</p>

<h1 id="set-the-hostname">Set the Hostname</h1>

<p>Before you begin installing and configuring the components described in this guide, please make sure you&rsquo;ve followed our instructions for <a href="/docs/getting-started#setting-the-hostname">setting your hostname</a>. Issue the following commands to make sure it is set properly:</p>

<pre><code>hostname
hostname -f
</code></pre>

<p>The first command should show your short hostname, and the second should show your fully qualified domain name (FQDN).</p>

<h1 id="installing-postfix">Installing Postfix</h1>

<p>Before we begin to install the basic email gateway, issue the following commands to ensure that your system is up to date and that the latest version of the package repository has been installed:</p>

<pre><code>apt-get update
apt-get upgrade
</code></pre>

<p>To install the Postfix MTA issue the following command:</p>

<pre><code>apt-get install postfix
</code></pre>

<p>During the installation process, the package manager will prompt you for the responses to a few questions. To the first question regarding the type of mail server you want to configure select &ldquo;Internet Site&rdquo; and continue as in the following image:</p>

<p><a href="/docs/assets/77-postfix-courier-mysql-02-mail-server-type-2.png"><img src="/docs/assets/77-postfix-courier-mysql-02-mail-server-type-2.png" alt="Selecting the Postfix mail server configuration type." /></a></p>

<p>The next prompt will ask for the system mail name. This should correspond to the canonical a fully qualified domain name (FQDN) that points to your Linode&rsquo;s IP address. In this example, we&rsquo;re using a machine specific hostname for our server. Set the reverse DNS for your Linode&rsquo;s IP address to the fully qualified domain name you assign as the system mail name. You will be able to send mail from additional domains as configured later in this document. See the following example:</p>

<p><a href="/docs/assets/78-postfix-courier-mysql-02-mail-server-type-3.png"><img src="/docs/assets/78-postfix-courier-mysql-02-mail-server-type-3.png" alt="Selecting the Postfix system mail name." /></a></p>

<p>When the installation process completes proceed with the configuration of Postfix.</p>

<h1 id="fundamental-postfix-configuration">Fundamental Postfix Configuration</h1>

<p>Begin by editing the <code>/etc/postfix/main.cf</code> file. Most of the default values should be correct. Modify the <code>myhostname</code> value to correspond to the fully qualified domain name (FQDN) for your server, in this case <code>lollipop.example.com</code>:</p>

<dl class="file-excerpt">
<dt>


		/etc/postfix/main.cf 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">myhostname</span> <span class="o">=</span> lollipop.example.com</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<p>Add the following lines to your configuration file. This configures postfix for virtual hosting:</p>

<dl class="file-excerpt">
<dt>


		/etc/postfix/main.cf 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span><span class="lnt">2</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">virtual_alias_maps</span> <span class="o">=</span> hash:/etc/postfix/virtual
<span class="nv">home_mailbox</span> <span class="o">=</span> mail/</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<p>Furthermore, this ensures that the domains listed in <code>mydestination</code> do not conflict with the address that you will receive or forward email with. The <code>home_mailbox</code> value determines the name of the folder where email messages are delivered when local delivery is configured. For the user <code>username</code> with a home directory of <code>/home/username/</code> new mail would be delivered in a <code>Maildir</code> directory located at <code>/home/username/mail/</code>. When you&rsquo;ve completed this configuration, issue the following command to reload the mail server:</p>

<pre><code>/etc/init.d/postfix reload
</code></pre>

<p>In the future, if you want to stop, start, or restart Postfix, issue the correct command from the following:</p>

<pre><code>/etc/init.d/postfix stop
/etc/init.d/postfix start
/etc/init.d/postfix restart
</code></pre>

<h1 id="email-virtual-hosting">Email Virtual Hosting</h1>

<h3 id="configure-mail-delivery">Configure Mail Delivery</h3>

<p>Once Postfix is properly configured, edit the <code>/etc/postfix/virtual</code> file to configure virtual hosting for your mail gateway. This provides instructions for the mail agent with regards to processing email that it receives. Prior to beginning, ensure that you have properly configured DNS to direct email to your mail gateway. Create an &ldquo;A Record&rdquo; for the machine specific domain name that corresponds to your <code>myhostname</code> FQDN (e.g. <code>lollipop.example.com</code>). Then, ensure that there are MX records for <em>all</em> domains that you want to process with this mail gateway pointed to that FQDN. Consider the following example <code>/etc/postfix/virtual</code> file:</p>

<dl class="file-excerpt">
<dt>


		/etc/postfix/virtual 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt"> 1</span><span class="lnt"> 2</span><span class="lnt"> 3</span><span class="lnt"> 4</span><span class="lnt"> 5</span><span class="lnt"> 6</span><span class="lnt"> 7</span><span class="lnt"> 8</span><span class="lnt"> 9</span><span class="lnt">10</span><span class="lnt">11</span><span class="lnt">12</span><span class="lnt">13</span><span class="lnt">14</span><span class="lnt">15</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">admin@example.org example
foreman@example.org example

username@example.com username
username@example.com username
username@example.com username

jim@example.com jim@chartercast.net
ted@example.com ted@chartercast.net
jay@example.com jay@chartercast.net

lollipop@example.com stacy@morris.net, username
jockey@example.org username, example

@oddington.com oddington</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<p>In this example there are a number of addresses in the <code>example.org</code> domain forwarded to the <code>example</code> system user account. In the next group, a collection of emails at different domains beginning with the <code>username</code> name, are all forwarded to the <code>username</code> system user group. Finally, a number of email addresses at the <code>example.com</code> domain are forwarded to external addresses at the fictitious <code>chartercast.net</code> domain. The next two email addresses are directed to multiple sources: <code>lollipop@example.com</code> mail is delivered to the local <code>username</code> user as well as the external email address <code>stacy@morris.net</code>, while <code>jockey@example.org</code> is delivered to the local system users <code>username</code> and <code>example</code>. Finally all messages sent to addresses within the <code>oddington.com</code> domain are forwarded to the mailbox for the <code>oddington</code> user.</p>

<p>When you&rsquo;ve successfully edited your <code>/etc/postfix/virtual</code> file to ensure the proper delivery of your email, issue the following command to rebuild the virtual alias database:</p>

<pre><code>postmap /etc/postfix/virtual
</code></pre>

<p>This will compile a database located at <code>/etc/postfix/virtual.db</code>. Every time that you modify the <code>/etc/postfix/virtual</code> file, run the above <code>postmap</code> command. Before Postfix can apply the changes that you&rsquo;ve made and compiled, you will need to reload the server:</p>

<pre><code>/etc/init.d/postfix reload
</code></pre>

<p>Reload the server after compiling a new <code>virtual.db</code> every time. Mail will now be delivered in accordance with the specification in the <code>/etc/postfix/virtual</code> file.</p>

<h3 id="create-mail-directories">Create Mail Directories</h3>

<p>Issue the following command to ensure that newly created user accounts have a <code>~/mail</code> directory:</p>

<pre><code>mkdir /etc/skel/mail/
</code></pre>

<p>Every existing user that receives email will also need to make their own <code>Maildir</code>, by issuing the following command:</p>

<pre><code>mkdir ~/mail/
</code></pre>

<h1 id="sending-email-securely">Sending Email Securely</h1>

<p>Typically, authentication for sending email is handled by the daemon that&rsquo;s configured to handle email downloading like Courier or Dovecot. Rather than configure another daemon or deploy a potentially convoluted and difficult to administer authentication system, this guide uses the OpenSSH package that is installed and active on Linodes by default.</p>

<p>Save the following script in the <code>/opt</code> directory on the system you wish to send email <em>from</em>:</p>

<dl class="file">
<dt>


		/opt/smtp-tunnel 


</dt>
<dd>







<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-perl" data-lang="perl"><span class="lnt"> 1</span><span class="lnt"> 2</span><span class="lnt"> 3</span><span class="lnt"> 4</span><span class="lnt"> 5</span><span class="lnt"> 6</span><span class="lnt"> 7</span><span class="lnt"> 8</span><span class="lnt"> 9</span><span class="lnt">10</span><span class="lnt">11</span><span class="lnt">12</span><span class="lnt">13</span><span class="lnt">14</span><span class="lnt">15</span><span class="lnt">16</span><span class="lnt">17</span><span class="lnt">18</span><span class="lnt">19</span><span class="lnt">20</span><span class="lnt">21</span><span class="lnt">22</span><span class="lnt">23</span><span class="lnt">24</span><span class="lnt">25</span><span class="lnt">26</span><span class="lnt">27</span><span class="lnt">28</span><span class="lnt">29</span><span class="lnt">30</span><span class="lnt">31</span><span class="lnt">32</span><span class="lnt">33</span><span class="lnt">34</span><span class="lnt">35</span><span class="lnt">36</span><span class="lnt">37</span><span class="lnt">38</span><span class="lnt">39</span><span class="lnt">40</span><span class="lnt">41</span><span class="lnt">42</span><span class="lnt">43</span><span class="lnt">44</span><span class="lnt">45</span><span class="lnt">46</span><span class="lnt">47</span><span class="lnt">48</span><span class="lnt">49</span><span class="lnt">50</span><span class="lnt">51</span><span class="lnt">52</span><span class="lnt">53</span><span class="lnt">54</span><span class="lnt">55</span><span class="lnt">56</span><span class="lnt">57</span><span class="lnt">58</span><span class="lnt">59</span><span class="lnt">60</span><span class="lnt">61</span><span class="lnt">62</span><span class="lnt">63</span><span class="lnt">64</span><span class="lnt">65</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-perl" data-lang="perl"><span class="ch">#!/usr/bin/perl</span>

<span class="c1"># A SMTP-over-SSH Port Forwarding Script</span>
<span class="c1"># Copyright (c) 2010 Linode, LLC</span>
<span class="c1"># Author: Philip C. Paradis &lt;pparadis@linode.com&gt;</span>
<span class="c1"># Modifications: Linode &lt;sam@linode.com&gt;</span>
<span class="c1"># Usage: smtp-tunnel [start|stop]</span>
<span class="c1"># Forward smtp traffic over ssh to a remote mailserver.</span>

<span class="c1">## Edit these values to reflect the authentication credentials for the</span>
<span class="c1">## SMTP server with which you wish to connect and send mail. If you</span>
<span class="c1">## have chosen to run your mailserver on your linode using an</span>
<span class="c1">## alternate port, modify the `$remote_port` value. You should not</span>
<span class="c1">## need to modify the `$remote_ip` value.</span>

<span class="nv">$remote_user</span> <span class="o">=</span> <span class="s">&#34;REMOTE-USER&#34;</span><span class="p">;</span>
<span class="nv">$remote_host</span> <span class="o">=</span> <span class="s">&#34;REMOTE-HOST&#34;</span><span class="p">;</span>
<span class="nv">$remote_port</span> <span class="o">=</span> <span class="s">&#34;25&#34;</span><span class="p">;</span>
<span class="nv">$remote_ip</span>   <span class="o">=</span> <span class="s">&#34;127.0.0.1&#34;</span><span class="p">;</span>

<span class="c1">## Modify these values if you are running a local SMTP server on port</span>
<span class="c1">## 25, or if you need to start the tunnel as a non-root user, as</span>
<span class="c1">## OpenSSH only allows root users to start tunnels to low-numbered</span>
<span class="c1">## &#34;privileged ports.&#34; If this is the case you will also need to</span>
<span class="c1">## modify the configuration of your local mail sending agent.</span>

<span class="nv">$local_ip</span>    <span class="o">=</span> <span class="s">&#34;127.0.0.1&#34;</span><span class="p">;</span>
<span class="nv">$local_port</span>  <span class="o">=</span> <span class="s">&#34;25&#34;</span><span class="p">;</span>

<span class="c1">## You do not need to edit this file beyond this point.</span>

<span class="c1">######################################################################</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">=~</span> <span class="sr">s/^\s+//</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">=~</span> <span class="sr">s/\s+$//</span><span class="p">;</span>

<span class="nv">$pid</span><span class="o">=</span><span class="sb">`ps ax|grep ssh|grep $local_port|grep $remote_port`</span><span class="p">;</span>
<span class="nv">$pid</span> <span class="o">=~</span> <span class="sr">s/^\s+//</span><span class="p">;</span>
<span class="nv">@pids</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">,</span><span class="nv">$pid</span><span class="p">);</span>
<span class="k">foreach</span> <span class="nv">$pid</span> <span class="p">(</span><span class="nv">@pids</span><span class="p">)</span>
<span class="p">{</span>
 <span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">=~</span> <span class="sr">/ps ax/</span><span class="p">)</span> <span class="p">{</span> <span class="k">next</span><span class="p">;</span> <span class="p">}</span>
 <span class="nb">split</span><span class="p">(</span><span class="sr">/ /</span><span class="p">,</span><span class="nv">$pid</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&#34;start&#34;</span><span class="p">)</span>
<span class="p">{</span>
 <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span> <span class="k">print</span> <span class="s">&#34;smtp-tunnel already running.\n&#34;</span><span class="p">;</span> <span class="nb">exit</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
 <span class="k">else</span>
 <span class="p">{</span>
  <span class="nb">system</span> <span class="s">&#34;ssh -f -L $local_ip:$local_port:$remote_ip:$remote_port $remote_user\@$remote_host -N&#34;</span><span class="p">;</span>
  <span class="nb">exit</span> <span class="mi">0</span><span class="p">;</span>
 <span class="p">}</span>
<span class="p">}</span>
<span class="k">elsif</span> <span class="p">(</span><span class="nb">lc</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&#34;stop&#34;</span><span class="p">)</span>
<span class="p">{</span>
 <span class="k">if</span> <span class="p">(</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span> <span class="nb">kill</span> <span class="mi">9</span><span class="p">,</span><span class="nv">$_</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="nb">exit</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
 <span class="k">else</span> <span class="p">{</span> <span class="nb">exit</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
 <span class="k">print</span> <span class="s">&#34;Usage: smtp-tunnel [start|stop]\n&#34;</span><span class="p">;</span>
 <span class="nb">exit</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>

<p>Edit this file to include your username and the location of your email gateway. If you can run this script as root on your local system or the system you want to send mail from, it is easiest to leave <code>$local_port</code> set to <code>25</code>, otherwise use an alternate port like <code>2525</code> or <code>2255</code>. When you&rsquo;ve completed these operations run the following commands to make this script executable and start the tunnel:</p>

<pre><code>cd /opt/
chmod +x /opt/smtp-tunnel
/opt/smtp-tunnel start
</code></pre>

<p>You may want to consider issuing the command to start the tunnel (<code>/opt/smtp-tunnel start</code>) as part of your boot script by including it in your <code>/etc/rc.local</code> file, or by creating a <code>@reboot</code> <a href="/docs/linux-tools/utilities/cron">cron job</a>. If your network configuration utility allows you to establish pre- and post-connection scripts, you may want to instantiate and destroy the tunnel during this process. To destroy the tunnel, issue the following command:</p>

<pre><code>/opt/smtp-tunnel stop
</code></pre>

<p>When the tunnel is active, you will be able to configure your local mail sending agent to send using the SMTP server &ldquo;localhost&rdquo; and port 25, or the alternate <code>$local_port</code> you configured. To configure the <code>msmtp</code> mail sending agent on an Mac OS X or Linux-based system consider the following configuration file:</p>

<dl class="file-excerpt">
<dt>


		~/.msmtprc 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span><span class="lnt">5</span><span class="lnt">6</span><span class="lnt">7</span><span class="lnt">8</span><span class="lnt">9</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">account default
host localhost
from username@example.com
port <span class="m">25</span>

account alternate
host localhost
from foreman@example.org
port <span class="m">2525</span></code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<p>Depending on the location of the <code>msmtp</code> binary, you can now send mail using <code>/usr/bin/msmtp</code> as your send mail interface. To send mail from the <code>alternate</code> account, specify the sendmail interface as <code>/usr/bin/msmtp --account=alternate</code>. You can now send mail using your mail gateway using an SSH tunnel.</p>

<h1 id="more-information">More Information</h1>

<p>You may wish to consult the following resources for additional information on this topic. While these are provided in the hope that they will be useful, please note that we cannot vouch for the accuracy or timeliness of externally hosted materials.</p>

<ul>
<li><a href="http://msmtp.sourceforge.net/">MSMTP Mail Sending Client</a></li>
<li><a href="http://postfix.org">Postfix</a></li>
<li><a href="http://www.postfix.org/VIRTUAL_README.html">Postfix Virtual Mail Handling</a></li>
<li><a href="/docs/dns-guides/introduction-to-dns">Introduction to the DNS System</a></li>
<li><a href="/docs/email/postfix/dovecot-mysql-debian-6-squeeze">Host Email with Postfix, Dovecot and MySQL on Debian 5 (Lenny)</a></li>
</ul>

            

            

<h2>See Also</h2>
<ul>
    
    
    <li><a href="/docs/email/postfix/basic-postfix-email-gateway-on-ubuntu-10-04-lucid/">Basic Postfix Email Gateway on Ubuntu 10.04 (Lucid) - Deprecated</a></li>
    
    
    
    <li><a href="/docs/email/postfix/basic-postfix-email-gateway-on-ubuntu-10-10-maverick/">Basic Postfix Email Gateway on Ubuntu 10.10 (Maverick) - Deprecated</a></li>
    
    
    
    <li><a href="/docs/email/postfix/basic-postfix-email-gateway-on-debian-5-lenny/">Basic Postfix Email Gateway on Debian 5 (Lenny) - Deprecated</a></li>
    
    
    
    <li><a href="/docs/email/postfix/configure-spf-and-dkim-in-postfix-on-debian-8/">Configure SPF and DKIM With Postfix on Debian 8</a></li>
    
    
    
    <li><a href="/docs/email/installing-mail-filtering-for-ubuntu-12-04/">Installing Mail Filtering for Ubuntu 12.04 - Deprecated</a></li>
    
    
</ul>


            
            
<p class="doc-license">This guide is published under a <a href="https://creativecommons.org/licenses/by-nd/4.0">CC BY-ND 4.0</a> license.</p>

          </div>
          <div id="doc-sidebar-container" class="col-sm-3 col-sm-pull-9 hidden-xs">
            <div id="doc-sidebar">
              <div markdown="0" class="doc-sidebar-inner" >
  <div class="input-group">
	<label class="sr-only" for="q">Search guides and tutorials</label>
	<input id="ss_keyword" name="q" type="text" class="form-control" placeholder="Search guides..."/>
	<span class="input-group-btn">
		<button type="submit" class="btn btn-blue" id="ds-search-btn"><span class="glyphicon glyphicon-search"></span></button>
	</span>
</div>
</div>

                
              <div class="doc-sidebar-inner" id="doc-sidebar-toc">
                <h3 id="doc-sidebar-title">In This Guide:</h3>
                <div class="sidebar sidebar-library nav navbar" id="markdown-toc">
                    <nav id="TableOfContents">
<ul>
<li><a href="#set-the-hostname">Set the Hostname</a></li>
<li><a href="#installing-postfix">Installing Postfix</a></li>
<li><a href="#fundamental-postfix-configuration">Fundamental Postfix Configuration</a></li>
<li><a href="#email-virtual-hosting">Email Virtual Hosting</a>
<ul>
<li>
<ul>
<li><a href="#configure-mail-delivery">Configure Mail Delivery</a></li>
<li><a href="#create-mail-directories">Create Mail Directories</a></li>
</ul></li>
</ul></li>
<li><a href="#sending-email-securely">Sending Email Securely</a></li>
<li><a href="#more-information">More Information</a></li>
</ul>
</nav>
                </div>
              </div>
              
              <div class="library-rss">
  <a href="https://linode.com/docs/index.xml"><i class="fa fa-rss-square"></i> RSS feed</a>
</div>

              <div markdown="0" class="library-signup">
  <form action="//linode.us7.list-manage.com/subscribe/post?u=f9b54ed743e1629877750e3f4&amp;id=68bafea72a&SIGNUP=library-website"
    method="post" class="email-signup" target="_blank" novalidate="">
    <i class="fa fa-envelope"></i>
    <h6>Monthly Guides Update</h6>
    <input name="EMAIL" type="email" class="form-control input-sm"
    placeholder="Email address" required="" />
    <div style="position: absolute; left: -5000px;" aria-hidden="true">
      <input type="text" name="b_f9b54ed743e1629877750e3f4_68bafea72a"
      tabindex="-1" value="">
    </div>
    <div style="display:none">
      <input type="checkbox" value="4" name="group[13][4]"
      id="mce-group[13]-13-0" checked="">
    </div>
    <button type="submit" class="btn btn-blue btn-sm btn-border email-signup" value="Subscribe"
    name="subscribe" id="mc-embedded-subscribe">Sign Up</button>
  </form>
</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<div class="modal fade" id="img-modal" tabindex="-1" role="dialog" aria-labelledby="imageModal" aria-hidden="true">
  <div class="modal-dialog modal-full">
    <div class="modal-content">
      <div class="modal-header">
        <h4 id="img-modal-title" class="modal-title">Image Detail</h4>
      </div>
      <div class="modal-body">
        <img id="img-modal-image" class="img-responsive">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-blue" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

        <footer>
            <section class="neutral some-space">
	<div class="container">
		<div class="row">
			<div class="col-sm-12 text-center">
				<h3>Get paid to write for Linode.</h3>
				<p class="lead">We're always expanding our docs. If you like to help people, can write, and want to earn some cash, learn how you can <a href="/docs/contribute">earn up to $300 for every guide you write</a> and we publish.</p>
			</div>
		</div>
	</div>
</section>
            <section id="pre-footer">
  <div class="container">
    <div class="row">
      <div class="col-sm-7">
        <span>Get started in the Linode Cloud today.</span>
      </div>
      <div class="col-sm-5 pad-xs">
        <a id="btn-signup-bottom" class="btn btn-lg btn-full btn-green" href="https://manager.linode.com/session/signup">Create an Account</a>
      </div>
    </div>
  </div>
</section>

<section class="dark">
  <div class="container">

    <div class="row">
      <div class="footer-col">
        <h5><a href="https://www.linode.com/linodes">Overview</a></h5>
        <ul>
          <li><a href="https://www.linode.com/pricing">Plans &amp; Pricing</a></li>
          <li><a href="https://www.linode.com/linodes">Features</a></li>
          <li><a href="https://www.linode.com/addons">Add-Ons</a></li>
          <li><a href="https://www.linode.com/managed">Managed</a></li>
          <li><a href="https://www.linode.com/professional-services">Professional Services</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h5><a href="https://linode.com/docs/">Resources</a></h5>
        <ul>
          <li><a href="https://linode.com/docs/">Guides &amp; Tutorials</a></li>
          <li><a href="https://www.linode.com/speedtest">Speed Test</a></li>
          <li><a href="https://forum.linode.com/">Forum</a></li>
          <li><a href="https://www.linode.com/chat">Chat</a></li>
          <li><a href="http://status.linode.com/">System Status</a></li>
        </ul>
      </div>


      <div class="footer-col">
        <h5><a href="https://www.linode.com/about">Company</a></h5>
        <ul>
          <li><a href="https://www.linode.com/about">About Us</a></li>
          <li><a href="https://blog.linode.com">Blog</a></li>
          <li><a href="https://www.linode.com/press">Press</a></li>
          <li><a href="https://www.linode.com/referrals">Referral System</a></li>
          <li><a href="https://www.linode.com/careers">Careers</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h5><a href="https://www.linode.com/contact">Contact Us</a></h5>
        <ul>
          <li><a href="tel:+18554546633">855-4-LINODE</a></li>
          <li><a href="tel:+18554546633">(855-454-6633)</a></li>
          <li><a href="tel:+16093807100">Intl.: +1 609-380-7100</a></li>
          <li><a href="mailto:support@linode.com">Email us</a></li>
          <li>
            <br />
            <a target="_blank" href="https://facebook.com/linode"><i class="fa fa-facebook-square"></i></a>
            <a target="_blank" href="https://twitter.com/linode"><i class="fa fa-twitter-square"></i></a>
            <a target="_blank" href="https://plus.google.com/+linode/"><i class="fa fa-google-plus-square"></i></a>
            <a target="_blank" href="https://linkedin.com/company/linode"><i class="fa fa-linkedin-square"></i></a>
            <a target="_blank" href="https://github.com/linode/"><i class="fa fa-github-square"></i></a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</section>

<section class="dark-moar">
  <div class="container">
    <div id="footer-copyright" class="row">
      <div class="col text-center">
        &copy; 2017 Linode, LLC
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/tos">Terms of Service</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/privacy">Privacy Policy</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/security">Security</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/compliance">Standards &amp; Compliance</a>
      </div>
    </div>
  </div>
</section>

        </footer>
        
             <script src="/docs/build/js/libs.js" type="text/javascript"></script>
<script src="/docs/build/js/main.js" type="text/javascript"></script>

        
        <script type="text/javascript">
$( "img[src^='\/docs\/assets']" ).each(function () {
  $( this ).parent().bind('click', false);
  $( this ).on('click', function(e) {
    var image_title = $( this ).attr('alt');
    var image_href = $( this ).parent().attr('href') || $( this ).attr('src');
    $( '#img-modal-image' ).attr('src', image_href);
    $( '#img-modal-title' ).text(image_title);
    $( '#img-modal' ).modal({ show: true });
  });
});
</script>



        
<script type="text/javascript">
 SidebarScroll.init()
</script>

    </body>
</html>