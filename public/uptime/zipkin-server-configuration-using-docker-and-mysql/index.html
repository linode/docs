<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Zipkin Server Configuration Using Docker and MySQL</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="description" content="This guide shows you how to use Zipkin in a Docker container for the purpose of tracking systems to collect and search timing data in order to identify latency problems on your websites.">
        <meta name="keywords" content="zipkin,  Docker,  tracking">
        
        <meta property="og:title" content="Zipkin Server Configuration Using Docker and MySQL">
        <meta property="og:type" content="article">
        <meta property="og:url" content="https://linode.com/docs/uptime/zipkin-server-configuration-using-docker-and-mysql/">
        <meta property="og:description" content="Zipkin is a distributed tracing system. This guide shows you how to use Docker to deploy Zipkin on Linode, to diagnose latency problems on your website">
        <meta property="og:site_name" content="Linode Guides &amp; Tutorials">
        
        
        <meta name="twitter:card" content="summary">
        
        <meta name="twitter:site" content="@linode">
        <link rel="alternate" type="application/rss" href="https://linode.com/docs/index.xml">

        
             <link href="/docs/build/stylesheets/home.css" rel='stylesheet' type='text/css'>

        
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
        <link rel="canonical" href="https://linode.com/docs/uptime/zipkin-server-configuration-using-docker-and-mysql/">
        <link rel="shortcut icon" href="/favicon.ico">
    </head>
    <body class="no-subnav">
         <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="searchLabel" id="ds-search-modal">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div id="ds-search-input">
				<div class="input-group col-md-12">
					<input id="ds-search" type="text" class="form-control input-lg" placeholder="Search" />
					<span class="input-group-btn">
						<button class="btn btn-info btn-lg" id="ds-search-btn-modal" type="button">
						<i class="glyphicon glyphicon-search"></i>
						</button>
					</span>
				</div>
				<ul class="list-group" id="ds-search-list">
				</ul>
			</div>
		</div>
	</div>
</div> 
         
        <header>
            <nav id="main-nav" class="navbar navbar-default" role="navigation">
  <div class="container">

    <div class="navbar-header">
      <button type="button" class="toggle navbar-toggle" data-toggle="collapse" data-target=".navbar-top-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="https://www.linode.com"><img id="navbar-logo" src="/docs/media/images/header/linode-logo.svg" style="height:57px"></a>
    </div>

    <div class="collapse navbar-collapse navbar-top-collapse">
      <ul class="nav navbar-nav navbar-right">

                <li><a href="https://www.linode.com/"><span class='nav-home'></span></a></li>
                <li><a href="https://www.linode.com/linodes">Features</a></li>
                <li><a href="https://www.linode.com/pricing">Pricing</a></li>
                <li><a href="https://www.linode.com/addons">Add-ons</a></li>

        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Resources <span class="caret"></span></a>
          <ul class="dropdown-menu dropdown-main-nav dropdown-mega">
            <li class="dropdown-third">
              <ul >
                <li><a href="https://linode.com/docs/getting-started">Getting Started</a></li>
                <li><a href="https://linode.com/docs/migrate-from-shared">Migrating to Linode</a></li>
                <li><a href="https://linode.com/docs/hosting-website">Hosting a Website</a></li>
                <li class="divider"></li>
                <li class="big"><a href="https://linode.com/docs"><i class="fa fa-book"></i> Guides &amp; Tutorials</a></li>
                <li class="divider visible-xs"></li>
              </ul>
            </li>
            <li class="dropdown-third middle">
              <ul >
                <li><a href="https://www.linode.com/api">API</a></li>
                <li><a href="https://www.linode.com/stackscripts">StackScripts</a></li>
                <li><a href="https://www.linode.com/mobile">Mobile</a></li>
                <li><a href="https://www.linode.com/cli" target="_blank">CLI</a></li>

                <li class="divider"></li>

                <li><a href="https://www.linode.com/chat"><i class="fa fa-bullhorn gray"></i> Chat</a></li>
                <li><a href="https://forum.linode.com"><i class="fa fa-comments"></i> Community Forum</a></li>
                <li class="divider visible-xs"></li>
              </ul>
            </li>
            <li class="dropdown-third">
              <ul >
                <li><a href="https://blog.linode.com">Blog</a></li>
                <li><a href="http://status.linode.com">System Status</a></li>
                <li><a href="https://www.linode.com/speedtest">Speed Test</a></li>
                <li><a href="https://www.linode.com/about">About Us</a></li>
                <li class="divider"></li>
                <li><a href="https://www.linode.com/contact"><i class="fa fa-user"></i> Contact Support</a></li>
              </ul>
            </li>
          </ul>
        </li>

        <li role="presentation" class="divider-vertical"><span>|</span></li>
          <li class=""><a href="https://manager.linode.com/">Log in <span class="login-caret"></span></a></li>
          <li class="visible-xs"><a href="https://manager.linode.com/session/signup">Sign up</a></li>
          <li class="hidden-xs"><div><a id="btn-signup-top" class="btn btn-sm btn-green navbar-btn hidden-xs" href="https://manager.linode.com/session/signup">Sign up</a></div></li>
      </ul>
    </div>

  </div>
</nav>

            <nav class="navbar subnav jumbotron" role="navigation">
  <div class="container">
    <div class="subnav-divider">

    </div>
  </div>
</nav>
        </header>
        
<section class="primary first-section">
  <div class="container">
    <div class="row breadcrumb-row">
  <div class="col-sm-12">
    <ol class="breadcrumb library-breadcrumb">
      





<li>
  
  <a href="https://linode.com/docs/">Guides &amp; Tutorials</a>
  
</li>


<li>
  
  <a href="https://linode.com/docs/uptime/">Uptime &amp; Analytics</a>
  
</li>


<li>
  
  Zipkin Server Configuration Using Docker and MySQL
  
</li>

    </ol>
  </div>
</div>

    <div class="row" itemscope itemtype="http://schema.org/TechArticle">
      <div class="col-sm-12">
        <div class="row">
          <div class="col-sm-9 col-sm-offset-3">
          </div>
        </div>
        <div class="row">
          <div id="article-body" class="col-sm-9 col-sm-push-3 doc">
            <h1 class="doc-title" itemprop="headline">Zipkin Server Configuration Using Docker and MySQL</h1>
<p markdown="0" class="doc-time doc-modified-time">
  <small class="updated">Updated <time itemprop="dateModified" datetime="2017-10-27T00:00:00Z">Friday, October 27, 2017</time> by Luis Cort√©s</small>
  
</p>

           <div class="row">
            <div class="col-sm-9"><div markdown="0" class="signup-top">
    <span>
        Use promo code <strong>DOCS10</strong> for $10 credit on a new account.
    </span>
    <form action="https://manager.linode.com/session/signup" style="display: inline">
        <button type="submit" target="_blank" class="btn btn-blue btn-sm btn-border">Try this Guide</button>
    </form>
</div>
</div>
            <div class="col-sm-3"><div class="social-share">
    <div class="btn-group share-group">
        <a data-toggle="dropdown" class="btn btn-info">
            <i class="fa fa-share-alt fa-inverse"></i>
        </a>
        <button href="#" data-toggle="dropdown" class="btn btn-info dropdown-toggle share">
        <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li>
                <a data-original-title="Twitter" rel="tooltip"  href="https://twitter.com/share?url=https%3a%2f%2flinode.com%2fdocs%2fuptime%2fzipkin-server-configuration-using-docker-and-mysql%2f&via=linode&text=Zipkin%20Server%20Configuration%20%e2%80%a6" class="btn btn-twitter" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-twitter"></i>
                </a>
            </li>
            <li>
                <a data-original-title="Facebook" rel="tooltip"  href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flinode.com%2fdocs%2fuptime%2fzipkin-server-configuration-using-docker-and-mysql%2f" class="btn btn-facebook" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-facebook"></i>
                </a>
            </li>
            <li>
                <a data-original-title="Hacker News" rel="tooltip"  href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flinode.com%2fdocs%2fuptime%2fzipkin-server-configuration-using-docker-and-mysql%2f&t=Zipkin%20Server%20Configuration%20Using%20Docker%20and%20MySQL" class="btn btn-hacker-news" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-hacker-news "></i>
                </a>
            </li>
        </ul>
    </div>
</div></div>
            </div>
            <div class="library-github" markdown="0">
	<i class="fa fa-github"></i>
	<strong>Contribute on GitHub</strong>
	<p>
		
		<a href="https://github.com/linode/docs">View Project</a> |
		<a href="https://github.com/linode/docs/blob/master/docs/uptime/zipkin-server-configuration-using-docker-and-mysql.md">View File</a> |
		<a href="https://github.com/linode/docs/edit/master/docs/uptime/zipkin-server-configuration-using-docker-and-mysql.md">Edit File</a>
	</p>
</div>
            
            

            

<p><a href="http://zipkin.io/">Zipkin</a> is a used for capturing timing data, it also has a centralized repository, and a microweb server that allows you to display, and search through spans and traces of your distributed programs or websites.</p>

<p>We can configure Zipkin by <a href="http://zipkin.io/pages/quickstart">deploying it in a Docker container</a>. Using this approach, we can match the latest version of Zipkin by just pulling down the latest images. You can Isolate the Docker service and dependencies to just the container(s), and chose where you want your data to persist. Most importantly, by using Docker, you can spend more time focused on data anlysis, instead of spending time on configuring a Zipkin as a service.</p>

<h2 id="before-you-begin">Before You Begin</h2>

<ol>
<li><p>Familiarize yourself with our <a href="/docs/getting-started">Getting Started</a> guide and complete the steps for setting your Linode&rsquo;s hostname and timezone. This guide will use the hostname &lsquo;zipkinhost&rsquo;.</p></li>

<li><p>This guide will use <code>sudo</code> wherever possible. Complete the sections of our <a href="/docs/security/securing-your-server">Securing Your Server</a> to create a standard user account, harden SSH access, and remove unnecessary network services. Do <strong>not</strong> follow the Configure a Firewall section yet. This guide includes firewall rules specifically for a Zipkin server.</p></li>

<li><p>Assuming you know how to instrument a Zipkin client machine or have walked through our <a href="/docs/uptime/set-up-a-zipkin-server">Set Up a Zipkin Server with Sample Website Tracking</a> guide.</p></li>

<li><p>You will need an analyst system (laptop or workstation) with a web browser. This system will be used to view the traces/spans in the Zipkin server through the Zipkin provided webservice.</p></li>
</ol>

<p>While Zipkin can be installed on a variety of distributions, this guide uses Fedora 26 in the examples to configure both the server and client Linodes. Remember to adjust any distribution-specific commands, and replace the example IPs, <code>192.0.2.0</code> and <code>203.0.113.0</code>, with the IP addresses of your Zipkin server and analyst machine, respectively.</p>

<h2 id="the-target-scenario">The Target Scenario</h2>

<p>Our main task is setting up a Zipkin server with MySQL, so that the spans/traces persist on the host file.</p>

<h2 id="zipkin-server-configuration">Zipkin Server Configuration</h2>

<h3 id="install-package-dependencies">Install Package Dependencies</h3>

<ol>
<li><p>Log into your Zipkin host machine and make sure your system is up to date:</p>

<pre><code>sudo dnf update &amp;&amp; sudo dnf upgrade
</code></pre></li>

<li><p>Add the Docker repository:</p>

<pre><code>sudo dnf install dnf-plugins-core
sudo dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo
</code></pre></li>

<li><p>Install Docker CE:</p>

<pre><code>sudo dnf install docker-ce
</code></pre></li>

<li><p>Enable Docker as a service:</p>

<pre><code>sudo systemctl enable docker.service
sudo systemctl start docker.service
</code></pre></li>

<li><p>(Optional) Add your limited user account to the <code>docker</code> group, so that you can run Docker commands without using <code>sudo</code>:</p>

<pre><code>sudo usermod -aG docker username
</code></pre>

<p>You can test your Docker installation by running <code>docker run hello-world</code>.</p></li>

<li><p>Install Docker Compose:</p>

<pre><code>curl -LO https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`uname -s`-`uname -m`
sudo mv docker-compose-Linux-x86_64 /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
</code></pre>

<p>You can test the installation with <code>docker-compose --version</code>.</p>

<blockquote class="note">
  <strong class="callout-title">Note</strong>
  <div>The current stable version of Docker Compose is 1.16.1. Check for the latest version at the <a href="https://github.com/docker/compose/releases">releases page</a> and update the version in the <code>curl</code> command accordingly.</div>
</blockquote>
</li>

<li><p>Install git:</p>

<pre><code>sudo dnf install git
</code></pre></li>

<li><p>Use git to retrieve the Zipkin Docker-compose yaml files at <a href="https://github.com/openzipkin/docker-zipkin">openzipkin/docker-zipkin</a>. This is one of the powerful features of Docker, these files hold all of the system level configurations we need, to run several different Zipkin configurations. Like, Zipkin with MySQL, Zipkin with elasticsearch, and Zipkin with Kakfa.</p>

<pre><code>cd ~
git clone https://github.com/openzipkin/docker-zipkin.git
</code></pre></li>

<li><p>Install MySQL:</p>

<pre><code>sudo dnf install mysql
</code></pre></li>
</ol>

<h3 id="configure-docker">Configure Docker</h3>

<p>The Docker service will manage your containers, the container&rsquo;s host, Zipkin services, and your MYSQL server.</p>

<p><img src="/docs/assets/zipkin/zipkin_docker_host_layout.png" alt="host layout" /></p>

<p>Docker is in charge of starting and stopping these services automatically when the host system is rebooted. it&rsquo;ll help us to map the ports from the container to the host&rsquo;s ports and it&rsquo;ll manage exporting the MySQL database files onto the host system. Docker can check to see if the container has failed, and restart it for us too. The host is in charge of running the actual Docker service and setting the firewall correctly.</p>

<p>Notice that the Zipkin container will expose port 9411 for its service, and the MySQL container will expose port 3306. We&rsquo;ll use the Docker-compose yaml files to forward port 9411 to the host&rsquo;s port 9411, so that the container will be accesible on the internet.</p>

<h4 id="zipkin-server-firewall-concepts">Zipkin Server Firewall Concepts</h4>

<p>To avoid the server being compromised, limit the exposure of our Zipkin server to just our analyst and client machines.</p>

<p>The default Fedora 26 firewall rules block all ports as a safety precaution. Create a new firewall zone to handle the Zipkin services without exposing too much of the system:</p>

<p>Our goal is to set up the Zipkin Server for:</p>

<ul>
<li>Thrift service: receiving data from clients</li>
<li>Web service: showing searches of time data</li>
<li>lock down access to only our web and analyst machines.</li>
</ul>

<h3 id="zipkin-server-firewall">Zipkin Server Firewall</h3>

<ol>
<li><p>Create a new zone in our firewall called <strong>zipkin</strong></p>

<pre><code>sudo firewall-cmd --new-zone=zipkin --permanent
</code></pre></li>

<li><p>Reload the firewall and refresh your zone list.</p>

<pre><code>sudo firewall-cmd --reload
</code></pre></li>

<li><p>Add an analyst machine IP (If you forget to define any source IPs, you will have no filtering on your IPs. You need at least 1 source IP to start filtering on IPs. If there are no source IPs defined, any machine can connect to your server.)</p>

<pre><code>sudo firewall-cmd --zone=zipkin --add-source=203.0.113.0/32  --permanent
</code></pre></li>

<li><p>Open a port through your firewall.</p>

<pre><code>sudo firewall-cmd --zone=zipkin --add-port=9411/tcp  --permanent
</code></pre></li>

<li><p>(Optional) Since we may want to access our machine from the analyst machine, it may be a good idea to add an ssh port.</p>

<pre><code>sudo firewall-cmd --zone=zipkin --add-service=ssh --permanent
</code></pre></li>

<li><p>Reload your firewall rules to activate them in your new zone.</p>

<pre><code>sudo firewall-cmd --reload
</code></pre></li>

<li><p>View your new zone:</p>

<pre><code>sudo firewall-cmd --zone=zipkin --list-all
</code></pre></li>
</ol>

<h3 id="docker-compose-configuration">Docker-Compose Configuration</h3>

<p>The <strong>docker-compose yml</strong> files will control which system configuration we can use. We&rsquo;re going to select a MySQL configuration for storage.</p>

<ol>
<li><p>Copy the MySQL docker-compose yaml file to your home directory and rename it docker-init.yml as we&rsquo;re going to need to make a few changes:</p>

<pre><code>cd ~
cp docker-zipkin/docker-compose.yml docker-init.yml
</code></pre></li>

<li><p>Open <code>docker-init.yml</code> in a text editor and edit the content as follows:</p>

<dl class="file-excerpt">
<dt>


		~/docker-init.yml 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt"> 1</span><span class="lnt"> 2</span><span class="lnt"> 3</span><span class="lnt"> 4</span><span class="lnt"> 5</span><span class="lnt"> 6</span><span class="lnt"> 7</span><span class="lnt"> 8</span><span class="lnt"> 9</span><span class="lnt">10</span><span class="lnt">11</span><span class="lnt">12</span><span class="lnt">13</span><span class="lnt">14</span><span class="lnt">15</span><span class="lnt">16</span><span class="lnt">17</span><span class="lnt">18</span><span class="lnt">19</span><span class="lnt">20</span><span class="lnt">21</span><span class="lnt">22</span><span class="lnt">23</span><span class="lnt">24</span><span class="lnt">25</span><span class="lnt">26</span><span class="lnt">27</span><span class="lnt">28</span><span class="lnt">29</span><span class="lnt">30</span><span class="lnt">31</span><span class="lnt">32</span><span class="lnt">33</span><span class="lnt">34</span><span class="lnt">35</span><span class="lnt">36</span><span class="lnt">37</span><span class="lnt">38</span><span class="lnt">39</span><span class="lnt">40</span><span class="lnt">41</span><span class="lnt">42</span><span class="lnt">43</span><span class="lnt">44</span><span class="lnt">45</span><span class="lnt">46</span><span class="lnt">47</span><span class="lnt">48</span><span class="lnt">49</span><span class="lnt">50</span><span class="lnt">51</span><span class="lnt">52</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">version: <span class="s1">&#39;2&#39;</span>

services:
  storage:
    image: openzipkin/zipkin-mysql
    container_name: mysql
    <span class="c1"># Uncomment to expose the storage port for testing
</span><span class="c1"></span>    ports:
      - <span class="m">3306</span>:3306
    volumes:
      - dbfiles:/mysql/data
    restart: unless-stopped

  zipkin:
    image: openzipkin/zipkin
    container_name: zipkin
    <span class="c1"># Environment settings are defined here https://github.com/openzipkin/zipkin/tree/1.19.0/zipkin-server#environment-variables
</span><span class="c1"></span>    environment:
      - <span class="nv">STORAGE_TYPE</span><span class="o">=</span>mysql
      <span class="c1"># Point the zipkin at the storage backend
</span><span class="c1"></span>      - <span class="nv">MYSQL_HOST</span><span class="o">=</span>mysql
      <span class="c1"># Uncomment to enable scribe
</span><span class="c1"></span>      <span class="c1"># - SCRIBE_ENABLED=true
</span><span class="c1"></span>      <span class="c1"># Uncomment to enable self-tracing
</span><span class="c1"></span>      <span class="c1"># - SELF_TRACING_ENABLED=true
</span><span class="c1"></span>      <span class="c1"># Uncomment to enable debug logging
</span><span class="c1"></span>      <span class="c1"># - JAVA_OPTS=-Dlogging.level.zipkin=DEBUG
</span><span class="c1"></span>    ports:
      <span class="c1"># Port used for the Zipkin UI and HTTP Api
</span><span class="c1"></span>      - <span class="m">9411</span>:9411
    depends_on:
      - storage
    restart: unless-stopped

  dependencies:
    image: openzipkin/zipkin-dependencies
    container_name: dependencies
    entrypoint: crond -f
    environment:
      - <span class="nv">STORAGE_TYPE</span><span class="o">=</span>mysql
      - <span class="nv">MYSQL_HOST</span><span class="o">=</span>mysql
      <span class="c1"># Add the baked-in username and password for the zipkin-mysql image
</span><span class="c1"></span>      - <span class="nv">MYSQL_USER</span><span class="o">=</span>zipkin
      - <span class="nv">MYSQL_PASS</span><span class="o">=</span>zipkin
      <span class="c1"># Uncomment to adjust memory used by the dependencies job
</span><span class="c1"></span>      - <span class="nv">JAVA_OPTS</span><span class="o">=</span>-verbose:gc -Xms512m -Xmx512m
    depends_on:
      - storage
    restart: unless-stopped

volumes:
  dbfiles:</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<ul>
<li><p>In the MySQL container section in the docker-init.yml, export the MySQL data directory, forward the MySQL port to the host, and add the restart command so that this service is automatically restarted if it goes down.</p></li>

<li><p>In the Zipkin container section in the docker-init.yml, make sure the port 9411 is forwarded to the host machine and add the restart command so that this service is automatically restarted if it goes down.</p></li>

<li><p>In the dependencies container, we uncomment the JAVA_OPTS and set it to at least 512M. This setting is optimized for a 1G Linode. However, if in the future this container needs more memory, you can increase this value. Add a restart command to the end of this section.</p></li>
</ul></li>

<li><p>You can now update your Zipkin Docker images by performing a <code>docker pull</code> command. This will check the web for the images we need (the first time), and all other times it&rsquo;ll update the images to the latest version if need be.</p>

<pre><code>docker-compose -f docker-init.yml pull
</code></pre></li>

<li><p>Run your Docker services by using the <code>docker-compose up</code> command. Conversely there is also a <code>docker-compose down</code> command that can be used to shutdown your Zipkin services.</p>

<pre><code>docker-compose -f docker-init.yml up -d
</code></pre>

<p>Notice the <strong>-d</strong> flag at the end of the command, this <strong>detaches</strong> the container. Now it&rsquo;s running as its own process. If we just left the machine, it would continue to run, even if we rebooted the machine, it would run when the Docker service started it, because we didn&rsquo;t explicitly issue a <code>docker-compose down</code> command. Just for reference, to shutdown the Zipkin services:</p>

<pre><code>docker-compose -f docker-init.yml down
</code></pre></li>
</ol>

<h3 id="backup-span-trace-data">Backup Span/Trace Data</h3>

<p>There are 2 different backup methods: using MySQL , and using sysadmin.</p>

<h4 id="mysql-backup">MySQL Backup</h4>

<ol>
<li><p>Ensure that the MySQL service is running on a container. You can check this with a <code>docker ps</code> command. The <code>docker ps</code> command displays the active containers:</p>

<dl class="file-excerpt">
<dt>


		docker -ps 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">CONTAINER ID        IMAGE                            COMMAND                  CREATED             STATUS              PORTS                              NAMES
023d14e6193d        openzipkin/zipkin-dependencies   <span class="s2">&#34;crond -f&#34;</span>               <span class="m">3</span> days ago          Up <span class="m">3</span> days                                              dependencies
ee0c255b7765        openzipkin/zipkin                <span class="s2">&#34;/bin/sh -c &#39;test ...&#34;</span>   <span class="m">3</span> days ago          Up <span class="m">3</span> days           <span class="m">9410</span>/tcp, <span class="m">0</span>.0.0.0:9411-&gt;9411/tcp   zipkin
43f659b36f17        openzipkin/zipkin-mysql          <span class="s2">&#34;/bin/sh -c /mysql...&#34;</span>   <span class="m">3</span> days ago          Up <span class="m">3</span> days           <span class="m">0</span>.0.0.0:3306-&gt;3306/tcp             mysql</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>
</li>

<li><p>If isn&rsquo;t running, make sure you start the Zipkin services with the <code>docker-compose up</code> command first. Then issue the MySQLdump with the following parameters from your Zipkin host machine.</p>

<pre><code> mysqldump --protocol=tcp -A -pzipkin -uzipkin &gt; ~/database.bak
</code></pre>

<p>This command will dump the entire MySQL database from your MySQL container into the file called database.bak in your home directory. Alternatively, you can just dump your Zipkin span/trace data with:</p>

<pre><code>mysqldump --protocol=tcp -pzipkin -uzipkin zipkin &gt; ~/db_zipkin.bak
</code></pre></li>
</ol>

<h4 id="database-backups">Database Backups</h4>

<p>We can just zip or tar the exported database files on the host system. Since we don&rsquo;t know if the container is writing information to these files at any given time, we need to make sure that the container is stopped.</p>

<ol>
<li><p>We can check the status with a <code>docker ps</code> command or just perform a <code>docker down</code> command.</p>

<pre><code>docker-compose -f docker-init.yml down
</code></pre>

<p>After the <code>docker down</code> command, we can perform a <code>docker ps</code> command and see that there are no containers running. That should look like this:</p>

<pre><code>CONTAINER ID        IMAGE      COMMAND    CREATED      STATUS       PORTS         NAMES
</code></pre></li>

<li><p>At this point, we can create a zip backup of your files. The db files will be prepended with the name of your user. If you are running as root it would be <strong>root_dbfiles</strong>, but running as root isn&rsquo;t recommended.</p>

<p>sudo zip -r ~/db_files.zip /var/lib/docker/volumes/<USER>_dbfiles/</p></li>

<li><p>Remember to start your Zipkin services if they&rsquo;re still needed. They will not restart even on a reboot because we have explicitly shut them down.</p></li>
</ol>

<h4 id="testing-the-zipkin-service">Testing the Zipkin Service</h4>

<ol>
<li><p>Easiest way to do this is by using your web browser on your analyst machine. Log into your analyst machine, bring up your browser, and type in the following URL:</p>

<pre><code>http://192.0.2.0:9411/zipkin/
</code></pre>

<p>If you see the Zipkin web page, you&rsquo;re done.</p></li>

<li><p>If you don&rsquo;t see a web page, log into the Zipkin host machine, and make sure your containers are up by running either <code>docker ps</code> command or <code>docker-compose up</code> command. If the containers are not all running, it&rsquo;s possible that your Linode has run out of memory.</p></li>

<li><p>Make sure your firewall port is open by typing:</p>

<pre><code>sudo firewall-cmd --add-port 9411/tcp --permanent
</code></pre></li>

<li><p>At this point, what might have happened is that we added the wrong IP address of our analyst machine. We can check this by logging into our analyst machine. If our analyst machine is a Fedora workstation, we can install <strong>nmap</strong> and perform a network port status check to our Zipkin host machine like so:</p>

<pre><code>sudo dnf install -y nmap
nmap 192.0.2.0 -p 9411 -Pn
</code></pre>

<p>A good return has an <strong>open</strong> for the STATE of the port, anything else and we probably don&rsquo;t have the right analyst machine IP address in our firewall rules:</p>

<pre><code>Starting Nmap 7.40 (https://nmap.org) at 2017-09-24 18:34 MDT
Nmap scan report for zipkin (192.0.2.0)
Host is up (0.10s latency).
PORT     STATE SERVICE
9411/tcp open  unknown
</code></pre>

<p>Review your firewall rules and try again.</p></li>
</ol>

            
<h2>More Information</h2>
<p>You may wish to consult the following resources for additional information on this topic. While these are provided in the hope that they will be useful, please note that we cannot vouch for the accuracy or timeliness of externally hosted materials.</p>
<ul>

<li><a href="http://zipkin.io/">Official ZipKin Documentation</a></li>

</ul>


            

<h2>See Also</h2>
<ul>
    
    
    <li><a href="/docs/uptime/set-up-a-zipkin-server/">Set Up a Zipkin Server</a></li>
    
    
</ul>


            
            
<p class="doc-license">This guide is published under a <a href="https://creativecommons.org/licenses/by-nd/4.0">CC BY-ND 4.0</a> license.</p>

          </div>
          <div id="doc-sidebar-container" class="col-sm-3 col-sm-pull-9 hidden-xs">
            <div id="doc-sidebar">
              <div markdown="0" class="doc-sidebar-inner" >
  <div class="input-group">
	<label class="sr-only" for="q">Search guides and tutorials</label>
	<input id="ss_keyword" name="q" type="text" class="form-control" placeholder="Search guides..."/>
	<span class="input-group-btn">
		<button type="submit" class="btn btn-blue" id="ds-search-btn"><span class="glyphicon glyphicon-search"></span></button>
	</span>
</div>
</div>

                
              <div class="doc-sidebar-inner" id="doc-sidebar-toc">
                <h3 id="doc-sidebar-title">In This Guide:</h3>
                <div class="sidebar sidebar-library nav navbar" id="markdown-toc">
                    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#before-you-begin">Before You Begin</a></li>
<li><a href="#the-target-scenario">The Target Scenario</a></li>
<li><a href="#zipkin-server-configuration">Zipkin Server Configuration</a>
<ul>
<li><a href="#install-package-dependencies">Install Package Dependencies</a></li>
<li><a href="#configure-docker">Configure Docker</a>
<ul>
<li><a href="#zipkin-server-firewall-concepts">Zipkin Server Firewall Concepts</a></li>
</ul></li>
<li><a href="#zipkin-server-firewall">Zipkin Server Firewall</a></li>
<li><a href="#docker-compose-configuration">Docker-Compose Configuration</a></li>
<li><a href="#backup-span-trace-data">Backup Span/Trace Data</a>
<ul>
<li><a href="#mysql-backup">MySQL Backup</a></li>
<li><a href="#database-backups">Database Backups</a></li>
<li><a href="#testing-the-zipkin-service">Testing the Zipkin Service</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
                </div>
              </div>
              
              <div class="library-rss">
  <a href="https://linode.com/docs/index.xml"><i class="fa fa-rss-square"></i> RSS feed</a>
</div>

              <div markdown="0" class="library-signup">
  <form action="//linode.us7.list-manage.com/subscribe/post?u=f9b54ed743e1629877750e3f4&amp;id=68bafea72a&SIGNUP=library-website"
    method="post" class="email-signup" target="_blank" novalidate="">
    <i class="fa fa-envelope"></i>
    <h6>Monthly Guides Update</h6>
    <input name="EMAIL" type="email" class="form-control input-sm"
    placeholder="Email address" required="" />
    <div style="position: absolute; left: -5000px;" aria-hidden="true">
      <input type="text" name="b_f9b54ed743e1629877750e3f4_68bafea72a"
      tabindex="-1" value="">
    </div>
    <div style="display:none">
      <input type="checkbox" value="4" name="group[13][4]"
      id="mce-group[13]-13-0" checked="">
    </div>
    <button type="submit" class="btn btn-blue btn-sm btn-border email-signup" value="Subscribe"
    name="subscribe" id="mc-embedded-subscribe">Sign Up</button>
  </form>
</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<div class="modal fade" id="img-modal" tabindex="-1" role="dialog" aria-labelledby="imageModal" aria-hidden="true">
  <div class="modal-dialog modal-full">
    <div class="modal-content">
      <div class="modal-header">
        <h4 id="img-modal-title" class="modal-title">Image Detail</h4>
      </div>
      <div class="modal-body">
        <img id="img-modal-image" class="img-responsive">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-blue" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

        <footer>
            <section class="neutral some-space">
	<div class="container">
		<div class="row">
			<div class="col-sm-12 text-center">
				<h3>Get paid to write for Linode.</h3>
				<p class="lead">We're always expanding our docs. If you like to help people, can write, and want to earn some cash, learn how you can <a href="/docs/contribute">earn up to $300 for every guide you write</a> and we publish.</p>
			</div>
		</div>
	</div>
</section>
            <section id="pre-footer">
  <div class="container">
    <div class="row">
      <div class="col-sm-7">
        <span>Get started in the Linode Cloud today.</span>
      </div>
      <div class="col-sm-5 pad-xs">
        <a id="btn-signup-bottom" class="btn btn-lg btn-full btn-green" href="https://manager.linode.com/session/signup">Create an Account</a>
      </div>
    </div>
  </div>
</section>

<section class="dark">
  <div class="container">

    <div class="row">
      <div class="footer-col">
        <h5><a href="https://www.linode.com/linodes">Overview</a></h5>
        <ul>
          <li><a href="https://www.linode.com/pricing">Plans &amp; Pricing</a></li>
          <li><a href="https://www.linode.com/linodes">Features</a></li>
          <li><a href="https://www.linode.com/addons">Add-Ons</a></li>
          <li><a href="https://www.linode.com/managed">Managed</a></li>
          <li><a href="https://www.linode.com/professional-services">Professional Services</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h5><a href="https://linode.com/docs/">Resources</a></h5>
        <ul>
          <li><a href="https://linode.com/docs/">Guides &amp; Tutorials</a></li>
          <li><a href="https://www.linode.com/speedtest">Speed Test</a></li>
          <li><a href="https://forum.linode.com/">Forum</a></li>
          <li><a href="https://www.linode.com/chat">Chat</a></li>
          <li><a href="http://status.linode.com/">System Status</a></li>
        </ul>
      </div>


      <div class="footer-col">
        <h5><a href="https://www.linode.com/about">Company</a></h5>
        <ul>
          <li><a href="https://www.linode.com/about">About Us</a></li>
          <li><a href="https://blog.linode.com">Blog</a></li>
          <li><a href="https://www.linode.com/press">Press</a></li>
          <li><a href="https://www.linode.com/referrals">Referral System</a></li>
          <li><a href="https://www.linode.com/careers">Careers</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h5><a href="https://www.linode.com/contact">Contact Us</a></h5>
        <ul>
          <li><a href="tel:+18554546633">855-4-LINODE</a></li>
          <li><a href="tel:+18554546633">(855-454-6633)</a></li>
          <li><a href="tel:+16093807100">Intl.: +1 609-380-7100</a></li>
          <li><a href="mailto:support@linode.com">Email us</a></li>
          <li>
            <br />
            <a target="_blank" href="https://facebook.com/linode"><i class="fa fa-facebook-square"></i></a>
            <a target="_blank" href="https://twitter.com/linode"><i class="fa fa-twitter-square"></i></a>
            <a target="_blank" href="https://plus.google.com/+linode/"><i class="fa fa-google-plus-square"></i></a>
            <a target="_blank" href="https://linkedin.com/company/linode"><i class="fa fa-linkedin-square"></i></a>
            <a target="_blank" href="https://github.com/linode/"><i class="fa fa-github-square"></i></a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</section>

<section class="dark-moar">
  <div class="container">
    <div id="footer-copyright" class="row">
      <div class="col text-center">
        &copy; 2017 Linode, LLC
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/tos">Terms of Service</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/privacy">Privacy Policy</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/security">Security</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/compliance">Standards &amp; Compliance</a>
      </div>
    </div>
  </div>
</section>

        </footer>
        
             <script src="/docs/build/js/libs.js" type="text/javascript"></script>
<script src="/docs/build/js/main.js" type="text/javascript"></script>

        
        <script type="text/javascript">
$( "img[src^='\/docs\/assets']" ).each(function () {
  $( this ).parent().bind('click', false);
  $( this ).on('click', function(e) {
    var image_title = $( this ).attr('alt');
    var image_href = $( this ).parent().attr('href') || $( this ).attr('src');
    $( '#img-modal-image' ).attr('src', image_href);
    $( '#img-modal-title' ).text(image_title);
    $( '#img-modal' ).modal({ show: true });
  });
});
</script>



        
<script type="text/javascript">
 SidebarScroll.init()
</script>

    </body>
</html>