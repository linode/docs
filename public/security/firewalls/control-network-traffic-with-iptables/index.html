<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Control Network Traffic with iptables</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="description" content="Use iptables to manage Netfilter rules.">
        <meta name="keywords" content="iptables, networking, firewalls, filtering">
        
        <meta property="og:title" content="Control Network Traffic with iptables">
        <meta property="og:type" content="article">
        <meta property="og:url" content="https://linode.com/docs/security/firewalls/control-network-traffic-with-iptables/">
        <meta property="og:description" content="Use iptables to manage Netfilter rules.">
        <meta property="og:site_name" content="Linode Guides &amp; Tutorials">
        
        
        <meta name="twitter:card" content="summary">
        
        <meta name="twitter:site" content="@linode">
        <link rel="alternate" type="application/rss" href="https://linode.com/docs/index.xml">

        
             <link href="/docs/build/stylesheets/home.css" rel='stylesheet' type='text/css'>

        
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,900' rel='stylesheet' type='text/css'>
        <link rel="canonical" href="https://linode.com/docs/security/firewalls/control-network-traffic-with-iptables/">
        <link rel="shortcut icon" href="/favicon.ico">
    </head>
    <body class="no-subnav">
         <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="searchLabel" id="ds-search-modal">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div id="ds-search-input">
				<div class="input-group col-md-12">
					<input id="ds-search" type="text" class="form-control input-lg" placeholder="Search" />
					<span class="input-group-btn">
						<button class="btn btn-info btn-lg" id="ds-search-btn-modal" type="button">
						<i class="glyphicon glyphicon-search"></i>
						</button>
					</span>
				</div>
				<ul class="list-group" id="ds-search-list">
				</ul>
			</div>
		</div>
	</div>
</div> 
         
        <header>
            <nav id="main-nav" class="navbar navbar-default" role="navigation">
  <div class="container">

    <div class="navbar-header">
      <button type="button" class="toggle navbar-toggle" data-toggle="collapse" data-target=".navbar-top-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="https://www.linode.com"><img id="navbar-logo" src="/docs/media/images/header/linode-logo.svg" style="height:57px"></a>
    </div>

    <div class="collapse navbar-collapse navbar-top-collapse">
      <ul class="nav navbar-nav navbar-right">

                <li><a href="https://www.linode.com/"><span class='nav-home'></span></a></li>
                <li><a href="https://www.linode.com/linodes">Features</a></li>
                <li><a href="https://www.linode.com/pricing">Pricing</a></li>
                <li><a href="https://www.linode.com/addons">Add-ons</a></li>

        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Resources <span class="caret"></span></a>
          <ul class="dropdown-menu dropdown-main-nav dropdown-mega">
            <li class="dropdown-third">
              <ul >
                <li><a href="https://linode.com/docs/getting-started">Getting Started</a></li>
                <li><a href="https://linode.com/docs/migrate-from-shared">Migrating to Linode</a></li>
                <li><a href="https://linode.com/docs/hosting-website">Hosting a Website</a></li>
                <li class="divider"></li>
                <li class="big"><a href="https://linode.com/docs"><i class="fa fa-book"></i> Guides &amp; Tutorials</a></li>
                <li class="divider visible-xs"></li>
              </ul>
            </li>
            <li class="dropdown-third middle">
              <ul >
                <li><a href="https://www.linode.com/api">API</a></li>
                <li><a href="https://www.linode.com/stackscripts">StackScripts</a></li>
                <li><a href="https://www.linode.com/mobile">Mobile</a></li>
                <li><a href="https://www.linode.com/cli" target="_blank">CLI</a></li>

                <li class="divider"></li>

                <li><a href="https://www.linode.com/chat"><i class="fa fa-bullhorn gray"></i> Chat</a></li>
                <li><a href="https://forum.linode.com"><i class="fa fa-comments"></i> Community Forum</a></li>
                <li class="divider visible-xs"></li>
              </ul>
            </li>
            <li class="dropdown-third">
              <ul >
                <li><a href="https://blog.linode.com">Blog</a></li>
                <li><a href="http://status.linode.com">System Status</a></li>
                <li><a href="https://www.linode.com/speedtest">Speed Test</a></li>
                <li><a href="https://www.linode.com/about">About Us</a></li>
                <li class="divider"></li>
                <li><a href="https://www.linode.com/contact"><i class="fa fa-user"></i> Contact Support</a></li>
              </ul>
            </li>
          </ul>
        </li>

        <li role="presentation" class="divider-vertical"><span>|</span></li>
          <li class=""><a href="https://manager.linode.com/">Log in <span class="login-caret"></span></a></li>
          <li class="visible-xs"><a href="https://manager.linode.com/session/signup">Sign up</a></li>
          <li class="hidden-xs"><div><a id="btn-signup-top" class="btn btn-sm btn-green navbar-btn hidden-xs" href="https://manager.linode.com/session/signup">Sign up</a></div></li>
      </ul>
    </div>

  </div>
</nav>

            <nav class="navbar subnav jumbotron" role="navigation">
  <div class="container">
    <div class="subnav-divider">

    </div>
  </div>
</nav>
        </header>
        
<section class="primary first-section">
  <div class="container">
    <div class="row breadcrumb-row">
  <div class="col-sm-12">
    <ol class="breadcrumb library-breadcrumb">
      







<li>
  
  <a href="https://linode.com/docs/">Guides &amp; Tutorials</a>
  
</li>


<li>
  
  <a href="https://linode.com/docs/security/">Security, Upgrades &amp; Backups</a>
  
</li>


<li>
  
  <a href="https://linode.com/docs/security/firewalls/">Firewalls</a>
  
</li>


<li>
  
  Control Network Traffic with iptables
  
</li>

    </ol>
  </div>
</div>

    <div class="row" itemscope itemtype="http://schema.org/TechArticle">
      <div class="col-sm-12">
        <div class="row">
          <div class="col-sm-9 col-sm-offset-3">
          </div>
        </div>
        <div class="row">
          <div id="article-body" class="col-sm-9 col-sm-push-3 doc">
            <h1 class="doc-title" itemprop="headline">Control Network Traffic with iptables</h1>
<p markdown="0" class="doc-time doc-modified-time">
  <small class="updated">Updated <time itemprop="dateModified" datetime="2017-02-28T00:00:00Z">Tuesday, February 28, 2017</time> by Linode</small>
  
</p>

           <div class="row">
            <div class="col-sm-9"><div markdown="0" class="signup-top">
    <span>
        Use promo code <strong>DOCS10</strong> for $10 credit on a new account.
    </span>
    <form action="https://manager.linode.com/session/signup" style="display: inline">
        <button type="submit" target="_blank" class="btn btn-blue btn-sm btn-border">Try this Guide</button>
    </form>
</div>
</div>
            <div class="col-sm-3"><div class="social-share">
    <div class="btn-group share-group">
        <a data-toggle="dropdown" class="btn btn-info">
            <i class="fa fa-share-alt fa-inverse"></i>
        </a>
        <button href="#" data-toggle="dropdown" class="btn btn-info dropdown-toggle share">
        <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li>
                <a data-original-title="Twitter" rel="tooltip"  href="https://twitter.com/share?url=https%3a%2f%2flinode.com%2fdocs%2fsecurity%2ffirewalls%2fcontrol-network-traffic-with-iptables%2f&via=linode&text=Control%20Network%20Traffic%20with%20%e2%80%a6" class="btn btn-twitter" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-twitter"></i>
                </a>
            </li>
            <li>
                <a data-original-title="Facebook" rel="tooltip"  href="http://www.facebook.com/sharer.php?u=https%3a%2f%2flinode.com%2fdocs%2fsecurity%2ffirewalls%2fcontrol-network-traffic-with-iptables%2f" class="btn btn-facebook" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-facebook"></i>
                </a>
            </li>
            <li>
                <a data-original-title="Hacker News" rel="tooltip"  href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2flinode.com%2fdocs%2fsecurity%2ffirewalls%2fcontrol-network-traffic-with-iptables%2f&t=Control%20Network%20Traffic%20with%20iptables" class="btn btn-hacker-news" data-placement="left" target="_blank" rel="noopener">
                    <i class="fa fa-hacker-news "></i>
                </a>
            </li>
        </ul>
    </div>
</div></div>
            </div>
            <div class="library-github" markdown="0">
	<i class="fa fa-github"></i>
	<strong>Contribute on GitHub</strong>
	<p>
		
		<a href="https://github.com/linode/docs">View Project</a> |
		<a href="https://github.com/linode/docs/blob/master/docs/security/firewalls/control-network-traffic-with-iptables.md">View File</a> |
		<a href="https://github.com/linode/docs/edit/master/docs/security/firewalls/control-network-traffic-with-iptables.md">Edit File</a>
	</p>
</div>
            
            

            

<p><strong>iptables</strong> is an application that allows users to configure specific rules that will be enforced by the kernel&rsquo;s <code>netfilter</code> framework. It acts as a packet filter and firewall that examines and directs traffic based on port, protocol and other criteria. This guide will focus on the configuration and application of iptables rulesets and will provide examples of ways they are commonly used.</p>

<p><img src="/docs/assets/control-network-traffic-with-iptables.png" alt="Control Network Traffic with iptables" /></p>

<p>By default, the iptables tool is included with your Linode-supplied distribution. In order to use iptables, you will need root (<code>sudo</code>) privileges.</p>

<h2 id="use-linux-iptables-to-manage-ipv4-traffic">Use Linux iptables to Manage IPv4 Traffic</h2>

<h3 id="the-iptables-command">The iptables Command</h3>

<p>Many options can be used with the iptables command. As stated above, iptables sets the rules that control network traffic. You can define different tables to handle these rules through chains, lists of rules that match a subset of packets. The table contains a variety of built-in chains, but you can add your own.</p>

<h3 id="basic-iptables-parameters-and-syntax">Basic iptables Parameters and Syntax</h3>

<p>Before we begin creating rules, let&rsquo;s review the syntax of an iptables rule.</p>

<p>For example, the following command adds a rule to the beginning of the chain that will drop all packets from the address <code>198.51.100.0</code>:</p>

<pre><code>iptables -I INPUT -s 198.51.100.0 -j DROP
</code></pre>

<p>The sample command above:</p>

<ol>
<li>Calls the <code>iptables</code> program</li>
<li>Uses the <code>-I</code> option for <em>insertion</em>. Using a rule with the insertion option will add it to the beginning of a chain and will be applied first. To indicate a specific placement in the chain, you may also use a number with the <code>-I</code> option.</li>
<li>The <code>-s</code> parameter, along with the IP address (198.51.100.0), indicates the <em>source</em>.</li>
<li>Finally, the <code>-j</code> parameter stands for <em>jump</em>. It specifies the target of the rule and what action will be performed if the packet is a match.</li>
</ol>

<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>-p, --protocol</code></td>
<td align="left">The protocol, such as TCP, UDP, etc.</td>
</tr>

<tr>
<td align="left"><code>-s, --source</code></td>
<td align="left">Can be an address, network name, hostname, etc.</td>
</tr>

<tr>
<td align="left"><code>-d, --destination</code></td>
<td align="left">An address, hostname, network name, etc.</td>
</tr>

<tr>
<td align="left"><code>-j, --jump</code></td>
<td align="left">Specifies the target of the rule; i.e. what to do if the packet matches.</td>
</tr>

<tr>
<td align="left"><code>-g, --goto chain</code></td>
<td align="left">Specifies that the processing will continue in a user-specified chain.</td>
</tr>

<tr>
<td align="left"><code>-i, --in-interface</code></td>
<td align="left">Names the interface from where packets are received.</td>
</tr>

<tr>
<td align="left"><code>-o, --out-interface</code></td>
<td align="left">Name of the interface by which a packet is being sent.</td>
</tr>

<tr>
<td align="left"><code>-f, --fragment</code></td>
<td align="left">The rule will only be applied to the second and subsequent fragments of fragmented packets.</td>
</tr>

<tr>
<td align="left"><code>-c, --set-counters</code></td>
<td align="left">Enables the admin to initialize the packet and byte counters of a rule.</td>
</tr>
</tbody>
</table>

<h3 id="default-tables">Default Tables</h3>

<p>Tables are made up of built-in chains and may also contain user-defined chains. The built-in tables will depend on the kernel configuration and the installed modules.</p>

<p>The default tables are as follows:</p>

<ul>
<li><p><strong>Filter</strong> - This is the default table. Its built-in chains are:</p>

<ul>
<li>Input: packets going to local sockets</li>
<li>Forward: packets routed through the server</li>
<li>Output: locally generated packets</li>
</ul></li>

<li><p><strong>Nat</strong> - When a packet creates a new connection, this table is used. Its built-in chains are:</p>

<ul>
<li>Prerouting: designating packets when they come in</li>
<li>Output: locally generated packets before routing takes place</li>
<li>Postrouting: altering packets on the way out</li>
</ul></li>

<li><p><strong>Mangle</strong> - Used for special altering of packets. Its chains are:</p>

<ul>
<li>Prerouting: incoming packets</li>
<li>Postrouting: outgoing packets</li>
<li>Output: locally generated packets that are being altered</li>
<li>Input: packets coming directly into the server</li>
<li>Forward: packets being routed through the server</li>
</ul></li>

<li><p><strong>Raw</strong> - Primarily used for configuring exemptions from connection tracking. The built-in chains are:</p>

<ul>
<li>Prerouting: packets that arrive by the network interface</li>
<li>Output: processes that are locally generated</li>
</ul></li>

<li><p><strong>Security</strong> - Used for Mandatory Access Control (MAC) rules. After the filter table, the security table is accessed next. The built-in chains are:</p>

<ul>
<li>Input: packets entering the server</li>
<li>Output: locally generated packets</li>
<li>Forward: packets passing through the server</li>
</ul></li>
</ul>

<h3 id="basic-iptables-options">Basic iptables Options</h3>

<p>There are many options that may be used with the <code>iptables</code> command:</p>

<table>
<thead>
<tr>
<th align="left">Option</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><code>-A --append</code></td>
<td align="left">Add one or more rules to the end of the selected chain.</td>
</tr>

<tr>
<td align="left"><code>-C --check</code></td>
<td align="left">Check for a rule matching the specifications in the selected chain.</td>
</tr>

<tr>
<td align="left"><code>-D --delete</code></td>
<td align="left">Delete one or more rules from the selected chain.</td>
</tr>

<tr>
<td align="left"><code>-F --flush</code></td>
<td align="left">Delete <em>all</em> the rules one-by-one.</td>
</tr>

<tr>
<td align="left"><code>-I --insert</code></td>
<td align="left">Insert one or more rules into the selected chain as the given rule number.</td>
</tr>

<tr>
<td align="left"><code>-L --list</code></td>
<td align="left">Display the rules in the selected chain.</td>
</tr>

<tr>
<td align="left"><code>-n --numeric</code></td>
<td align="left">Display the IP address or hostname and post number in numeric format.</td>
</tr>

<tr>
<td align="left"><code>-N --new-chain &lt;name&gt;</code></td>
<td align="left">Create a new user-defined chain.</td>
</tr>

<tr>
<td align="left"><code>-v --verbose</code></td>
<td align="left">Provide more information when used with the list option.</td>
</tr>

<tr>
<td align="left"><code>-X --delete-chain &lt;name&gt;</code></td>
<td align="left">Delete the user-defined chain.</td>
</tr>
</tbody>
</table>

<h3 id="insert-replace-or-delete-iptables-rules">Insert, Replace or Delete iptables Rules</h3>

<p>iptables rules are enforced top down, so the first rule in the ruleset is applied to traffic in the chain, then the second, third and so on. This means that rules cannot necessarily be added to a ruleset with <code>iptables -A</code> or <code>ip6tables -A</code>. Instead, rules must be <em>inserted</em> with <code>iptables -I</code> or <code>ip6tables -I</code>.</p>

<p><strong>Insert</strong></p>

<p>Inserted rules need to be placed in the correct order with respect to other rules in the chain. To get a numerical list of your iptables rules:</p>

<pre><code>sudo iptables -L -nv --line-numbers
</code></pre>

<p>For example, let&rsquo;s say you want to insert a rule into the <a href="#basic-iptables-rulesets-for-ipv4-and-ipv6">basic ruleset</a> provided in this guide, that will accept incoming connections to port 8080 over the TCP protocol. We&rsquo;ll add it as rule 7 to the INPUT chain, following the web traffic rules:</p>

<pre><code>sudo iptables -I INPUT 7 -p tcp --dport 8080 -m state --state NEW -j ACCEPT
</code></pre>

<p>If you now run <code>sudo iptables -L -nv</code> again, you&rsquo;ll see the new rule in the output.</p>

<p><strong>Replace</strong></p>

<p>Replacing a rule is similar to inserting, but instead uses <code>iptables -R</code>. For example, let&rsquo;s say you want to reduce the logging of denied entries to only 3 per minute, down from 5 in the original ruleset. The LOG rule is ninth in the INPUT chain:</p>

<pre><code>sudo iptables -R INPUT 9 -m limit --limit 3/min -j LOG --log-prefix &quot;iptables_INPUT_denied: &quot; --log-level 7
</code></pre>

<p><strong>Delete</strong></p>

<p>Deleting a rule is also done using the rule number. For example, to delete the rule we just inserted for port 8080:</p>

<pre><code>sudo iptables -D INPUT 7
</code></pre>

<blockquote class="caution">
  <strong class="callout-title">Caution</strong>
  <div>Editing rules does not automatically save them. See our section on <a href="/docs/security/firewalls/control-network-traffic-with-iptables#deploy-your-iptables-rulesets">deploying rulesets</a> for the specific instructions for your distribution.</div>
</blockquote>


<h3 id="view-your-current-iptables-rules">View Your Current iptables Rules</h3>

<p>IPv4:</p>

<pre><code>sudo iptables -L -nv
</code></pre>

<p>IPv6:</p>

<pre><code>sudo ip6tables -L -nv
</code></pre>

<p>On most distributions, iptables has no default rules for either IPv4 and IPv6. As a result, on a newly created Linode you will likely see what is shown below - three empty chains without any firewall rules. This means that all incoming, forwarded and outgoing traffic is <em>allowed</em>. It&rsquo;s important to limit inbound and forwarded traffic to only what&rsquo;s necessary.</p>

<pre><code>Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
</code></pre>

<h2 id="configure-iptables">Configure iptables</h2>

<p>iptables can be configured and used in a variety of ways. The following sections will outline how to configure rules by port and IP, as well as how to blacklist (block) or whitelist (allow) addresses.</p>

<h3 id="block-traffic-by-port">Block Traffic by Port</h3>

<p>You may use a port to block all traffic coming in on a specific interface. For example:</p>

<pre><code>iptables -A INPUT -j DROP -p tcp --destination-port 110 -i eth0
</code></pre>

<p>Let&rsquo;s examine what each part of this command does:</p>

<ul>
<li><code>-A</code>  will add or append the rule to the end of the chain.</li>
<li><code>INPUT</code> will add the rule to the table.</li>
<li><code>DROP</code> means the packets are discarded.</li>
<li><code>-p tcp</code> means the rule will only drop TCP packets.</li>
<li><code>--destination-port 110</code> filters packets targeted to port 110.</li>
<li><code>-i eth0</code> means this rule will impact only packets arriving on the <em>eth0</em> interface.</li>
</ul>

<p>It is important to understand that iptables do <em>not</em> recognize aliases on the network interface. Therefore, if you have several virtual IP interfaces, you will have to specify the destination address to filter the traffic. A sample command is provided below:</p>

<pre><code>iptables -A INPUT -j DROP -p tcp --destination-port 110 -i eth0 -d 198.51.100.0
</code></pre>

<p>You may also use <code>-D</code> or <code>--delete</code> to remove rules. For example, these commands are equivalent:</p>

<pre><code>iptables --delete INPUT -j DROP -p tcp --destination-port 110 -i eth0 -d 198.51.100.0
iptables -D INPUT -j DROP -p tcp --destination-port 110 -i eth0 -d 198.51.100.0
</code></pre>

<h3 id="drop-traffic-from-an-ip">Drop Traffic from an IP</h3>

<p>In order to drop all incoming traffic from a specific IP address, use the iptables command with the following options:</p>

<pre><code>iptables -I INPUT -s 198.51.100.0 -j DROP
</code></pre>

<p>To remove these rules, use the <code>--delete</code> or <code>-D</code> option:</p>

<pre><code>iptables --delete INPUT -s 198.51.100.0 -j DROP
iptables -D INPUT -s 198.51.100.0 -j DROP
</code></pre>

<h3 id="block-or-allow-traffic-by-port-number-to-create-an-iptables-firewall">Block or Allow Traffic by Port Number to Create an iptables Firewall</h3>

<p>One way to create a firewall is to block all traffic to the system and then allow traffic on certain ports. Below is a sample sequence of commands to illustrate the process:</p>

<pre><code>iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A INPUT -i lo -m comment --comment &quot;Allow loopback connections&quot; -j ACCEPT
iptables -A INPUT -p icmp -m comment --comment &quot;Allow Ping to work as expected&quot; -j ACCEPT
iptables -A INPUT -p tcp -m multiport --destination-ports 22,25,53,80,443,465,5222,5269,5280,8999:9003 -j ACCEPT
iptables -A INPUT -p udp -m multiport --destination-ports 53 -j ACCEPT
iptables -P INPUT DROP
iptables -P FORWARD DROP
</code></pre>

<p>Let&rsquo;s break down the example above. The first two commands add or append rules to the <code>INPUT</code> chain in order to allow access on specific ports. The <code>-p tcp</code> and <code>-p udp</code> options specify either UDP or TCP packet types. The <code>-m multiport</code> function matches packets on the basis of their source or destination ports, and can accept the specification of up to 15 ports. Multiport also accepts ranges such as <code>8999:9003</code> which counts as 2 of the 15 possible ports, but matches ports <code>8999</code>, <code>9000</code>, <code>9001</code>, <code>9002</code>, and <code>9003</code>. The next command allows all incoming and outgoing packets that are associated with existing connections so that they will not be inadvertently blocked by the firewall. The final two commands use the <code>-P</code> option to describe the <em>default policy</em> for these chains. As a result, all packets processed by <code>INPUT</code> and <code>FORWARD</code> will be dropped by default.</p>

<p>Note that the rules described above only control incoming packets, and do not limit outgoing connections.</p>

<h3 id="whitelist-blacklist-traffic-by-address">Whitelist/Blacklist Traffic by Address</h3>

<p>You can use iptables to block all traffic and then only allow traffic from certain IP addresses. These firewall rules limit access to specific resources at the network layer. Below is an example sequence of commands:</p>

<pre><code>iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
iptables -A INPUT -i lo -m comment --comment &quot;Allow loopback connections&quot; -j ACCEPT
iptables -A INPUT -p icmp -m comment --comment &quot;Allow Ping to work as expected&quot; -j ACCEPT
iptables -A INPUT -s 192.168.1.0/24 -j ACCEPT
iptables -A INPUT -s 198.51.100.0 -j ACCEPT
iptables -P INPUT DROP
iptables -P FORWARD DROP
</code></pre>

<p>In the first command, the <code>-s 192.168.1.0/24</code> statement specifies that all source IPs (<code>-s</code>) in the address space of <code>192.168.1</code> are allowed. You may specify an IP address range using CIDR (Classless Inter-Domain Routing) notation, or individual IP addresses, as in the second command. The third command allows all incoming and outgoing packets that are associated with existing connections. The final two commands set the default policy for all <code>INPUT</code> and <code>FORWARD</code> chains to drop all packets.</p>

<h2 id="use-ip6tables-to-manage-ipv6-traffic">Use ip6tables to Manage IPv6 Traffic</h2>

<p>When you&rsquo;re working with IPv6, remember that the <code>iptables</code> command is not compatible. Instead, there is an <code>ip6tables</code> command. The options such as append, check, etc. are the same. The tables used by ip6tables are <em>raw</em>, <em>security</em>, <em>mangle</em> and <em>filter</em>. The parameters such as protocol, source, etc. are the same. The syntax is essentially the same as IPv4. Sample syntax is below:</p>

<pre><code>ip6tables [-t table] -N chain
</code></pre>

<p>To view what rules are configured for IPv6, use the command:</p>

<pre><code>ip6tables -L
</code></pre>

<h3 id="configure-rules-for-ipv6">Configure Rules for IPv6</h3>

<p>ip6tables works by using ports, specific addresses for blacklisting, protocols and so forth. The primary difference is that ip6tables can use extended packet matching modules with the <code>-m</code> or <code>match</code> options, followed by the module name. Below are some of the extended modules:</p>

<ul>
<li><strong>addrtype</strong> - Matches packets based on their address type. Some of the address types are:

<ul>
<li>Local</li>
<li>Unicast</li>
<li>Broadcast</li>
<li>Multicast</li>
</ul></li>
<li><strong>ah</strong> - Matches the parameters in the authentication header of IPsec packets.</li>
<li><strong>cluster</strong> - You can deploy gateway and backend load-sharing clusters without a load balancer.</li>
<li><strong>comment</strong> - Allows you to add a comment to any rule.</li>
<li><strong>connbytes</strong> - Matches by how many bytes or packets a connection has transferred, or average bytes per packet.</li>
</ul>

<p>This is not intended to be a complete or comprehensive list. You may review the full list of extended modules by using the <code>man</code> page:</p>

<pre><code>man ip6tables
</code></pre>

<p>Below is a sample rule used in ip6tables:</p>

<pre><code># limit the number of parallel HTTP requests to 16 for the link local network
ip6tables -A INPUT -p tcp --syn --dport 80 -s fe80::/64 -m connlimit --connlimit-above 16 --connlimit-mask 64 -j REJECT
ip6tables -A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
</code></pre>

<p>This rule breaks down as follows:</p>

<ul>
<li>The first line is a comment.</li>
<li><code>-A</code> is for append.</li>
<li><code>INPUT</code> is to add the rule to the table.</li>
<li><code>-p</code> is for protocol, which is TCP.</li>
<li><code>--syn</code> only matches TCP packets with the SYN bit set and the ACK, RST, and FIN bits cleared.</li>
<li><code>--dport</code> is the destination port, which is 80.</li>
<li><code>-s</code> is the source, which is the local address range fe80::/64.</li>
<li><code>-m</code> is for match.</li>
<li><code>connlimit</code> is the extended packet module name, which is connection limit.</li>
<li><code>--connlimit-above 16</code> means if the number of connections exceeds 16, only the first 16 will be used.</li>
<li><code>--connlimit-mask 64</code> means the group hosts are using a prefix length of 64.</li>
<li><code>-j</code> is for jump, it tells the target of the rule what to do if the packet is a match.</li>
<li><code>REJECT</code> means the packet is dropped.</li>
</ul>

<h3 id="required-rules-for-non-static-ipv6-allocations">Required Rules for Non-Static IPv6 Allocations</h3>

<pre><code># Below are the rules which are required for your IPv6 address to be properly allocated
ip6tables -A INPUT -p icmpv6 --icmpv6-type router-advertisement -m hl --hl-eq 255 -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type neighbor-solicitation -m hl --hl-eq 255 -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type neighbor-advertisement -m hl --hl-eq 255 -j ACCEPT
ip6tables -A INPUT -p icmpv6 --icmpv6-type redirect -m hl --hl-eq 255 -j ACCEPT
</code></pre>

<h2 id="basic-iptables-rulesets-for-ipv4-and-ipv6">Basic iptables Rulesets for IPv4 and IPv6</h2>

<p>Appropriate firewall rules depend on the services being run. Below are iptables rulesets to secure your Linode if you&rsquo;re running a web server.</p>

<blockquote class="caution">
  <strong class="callout-title">Caution</strong>
  <div><strong>These rules are given only as an example.</strong> A real production web server may require more or less configuration, and these rules would not be appropriate for a database, Minecraft or VPN server. Iptables rules can always be modified or reset later, but these basic rulesets serve as a demonstration.</div>
</blockquote>


<p><strong>IPv4</strong></p>

<dl class="file">
<dt>


		/tmp/v4 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt"> 1</span><span class="lnt"> 2</span><span class="lnt"> 3</span><span class="lnt"> 4</span><span class="lnt"> 5</span><span class="lnt"> 6</span><span class="lnt"> 7</span><span class="lnt"> 8</span><span class="lnt"> 9</span><span class="lnt">10</span><span class="lnt">11</span><span class="lnt">12</span><span class="lnt">13</span><span class="lnt">14</span><span class="lnt">15</span><span class="lnt">16</span><span class="lnt">17</span><span class="lnt">18</span><span class="lnt">19</span><span class="lnt">20</span><span class="lnt">21</span><span class="lnt">22</span><span class="lnt">23</span><span class="lnt">24</span><span class="lnt">25</span><span class="lnt">26</span><span class="lnt">27</span><span class="lnt">28</span><span class="lnt">29</span><span class="lnt">30</span><span class="lnt">31</span><span class="lnt">32</span><span class="lnt">33</span><span class="lnt">34</span><span class="lnt">35</span><span class="lnt">36</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">*filter

<span class="c1"># Allow all loopback (lo0) traffic and reject traffic
</span><span class="c1"># to localhost that does not originate from lo0.
</span><span class="c1"></span>-A INPUT -i lo -j ACCEPT
-A INPUT ! -i lo -s <span class="m">127</span>.0.0.0/8 -j REJECT

<span class="c1"># Allow ping.
</span><span class="c1"></span>-A INPUT -p icmp -m state --state NEW --icmp-type <span class="m">8</span> -j ACCEPT

<span class="c1"># Allow SSH connections.
</span><span class="c1"></span>-A INPUT -p tcp --dport <span class="m">22</span> -m state --state NEW -j ACCEPT

<span class="c1"># Allow HTTP and HTTPS connections from anywhere
</span><span class="c1"># (the normal ports for web servers).
</span><span class="c1"></span>-A INPUT -p tcp --dport <span class="m">80</span> -m state --state NEW -j ACCEPT
-A INPUT -p tcp --dport <span class="m">443</span> -m state --state NEW -j ACCEPT

<span class="c1"># Allow inbound traffic from established connections.
</span><span class="c1"># This includes ICMP error returns.
</span><span class="c1"></span>-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

<span class="c1"># Log what was incoming but denied (optional but useful).
</span><span class="c1"></span>-A INPUT -m limit --limit <span class="m">5</span>/min -j LOG --log-prefix <span class="s2">&#34;iptables_INPUT_denied: &#34;</span> --log-level <span class="m">7</span>

<span class="c1"># Reject all other inbound.
</span><span class="c1"></span>-A INPUT -j REJECT

<span class="c1"># Log any traffic that was sent to you
</span><span class="c1"># for forwarding (optional but useful).
</span><span class="c1"></span>-A FORWARD -m limit --limit <span class="m">5</span>/min -j LOG --log-prefix <span class="s2">&#34;iptables_FORWARD_denied: &#34;</span> --log-level <span class="m">7</span>

<span class="c1"># Reject all traffic forwarding.
</span><span class="c1"></span>-A FORWARD -j REJECT

COMMIT</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>

<p><strong>Optional:</strong> If you plan to use <a href="/docs/platform/longview/longview">Linode Longview</a> or <a href="/docs/platform/nodebalancer/getting-started-with-nodebalancers">Linode&rsquo;s NodeBalancers</a>, add the respective rule after the section for allowing HTTP and HTTPS connections:</p>

<pre><code># Allow incoming Longview connections from longview.linode.com
-A INPUT -s 96.126.119.66 -m state --state NEW -j ACCEPT

# Allow incoming NodeBalancer connections
-A INPUT -s 192.168.255.0/24 -m state --state NEW -j ACCEPT
</code></pre>

<p><strong>IPv6</strong></p>

<p>If you would like to supplement your web server&rsquo;s IPv4 rules with IPv6 as well, this ruleset will allow HTTP/S access and all ICMP functions.</p>

<dl class="file">
<dt>


		/tmp/v6 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt"> 1</span><span class="lnt"> 2</span><span class="lnt"> 3</span><span class="lnt"> 4</span><span class="lnt"> 5</span><span class="lnt"> 6</span><span class="lnt"> 7</span><span class="lnt"> 8</span><span class="lnt"> 9</span><span class="lnt">10</span><span class="lnt">11</span><span class="lnt">12</span><span class="lnt">13</span><span class="lnt">14</span><span class="lnt">15</span><span class="lnt">16</span><span class="lnt">17</span><span class="lnt">18</span><span class="lnt">19</span><span class="lnt">20</span><span class="lnt">21</span><span class="lnt">22</span><span class="lnt">23</span><span class="lnt">24</span><span class="lnt">25</span><span class="lnt">26</span><span class="lnt">27</span><span class="lnt">28</span><span class="lnt">29</span><span class="lnt">30</span><span class="lnt">31</span><span class="lnt">32</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">*filter

<span class="c1"># Allow all loopback (lo0) traffic and reject traffic
</span><span class="c1"># to localhost that does not originate from lo0.
</span><span class="c1"></span>-A INPUT -i lo -j ACCEPT
-A INPUT ! -i lo -s ::1/128 -j REJECT

<span class="c1"># Allow ICMP
</span><span class="c1"></span>-A INPUT -p icmpv6 -j ACCEPT

<span class="c1"># Allow HTTP and HTTPS connections from anywhere
</span><span class="c1"># (the normal ports for web servers).
</span><span class="c1"></span>-A INPUT -p tcp --dport <span class="m">80</span> -m state --state NEW -j ACCEPT
-A INPUT -p tcp --dport <span class="m">443</span> -m state --state NEW -j ACCEPT

<span class="c1"># Allow inbound traffic from established connections.
</span><span class="c1"></span>-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

<span class="c1"># Log what was incoming but denied (optional but useful).
</span><span class="c1"></span>-A INPUT -m limit --limit <span class="m">5</span>/min -j LOG --log-prefix <span class="s2">&#34;ip6tables_INPUT_denied: &#34;</span> --log-level <span class="m">7</span>

<span class="c1"># Reject all other inbound.
</span><span class="c1"></span>-A INPUT -j REJECT

<span class="c1"># Log any traffic that was sent to you
</span><span class="c1"># for forwarding (optional but useful).
</span><span class="c1"></span>-A FORWARD -m limit --limit <span class="m">5</span>/min -j LOG --log-prefix <span class="s2">&#34;ip6tables_FORWARD_denied: &#34;</span> --log-level <span class="m">7</span>

<span class="c1"># Reject all traffic forwarding.
</span><span class="c1"></span>-A FORWARD -j REJECT

COMMIT</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>

<blockquote class="note">
  <strong class="callout-title">Note</strong>
  <div><p><a href="http://linux.die.net/man/8/apt">APT</a> attempts to resolve mirror domains to IPv6 as a result of <code>apt-get update</code>. If you choose to entirely disable and deny IPv6, this will slow down the update process for Debian and Ubuntu because APT waits for each resolution to time out before moving on.</p>

<p>To remedy this, uncomment the line <code>precedence ::ffff:0:0/96  100</code> in <code>/etc/gai.conf</code>.</p>
</div>
</blockquote>


<h2 id="deploy-your-iptables-rulesets">Deploy Your iptables Rulesets</h2>

<p>The process for deploying iptables rulesets varies depending on which Linux distribution you&rsquo;re using:</p>

<h3 id="debian-ubuntu">Debian / Ubuntu</h3>

<p>UFW is the iptables controller included with Ubuntu, but it is also available in Debian&rsquo;s repositories. If you prefer to use UFW instead of iptables, see our guide: <a href="/docs/security/firewalls/configure-firewall-with-ufw">How to Configure a Firewall with UFW</a>.</p>

<ol>
<li><p>Create the files <code>/tmp/v4</code> and <code>/tmp/v6</code>. Paste the <a href="#basic-iptables-rulesets-for-ipv4-and-ipv6">above rulesets</a> into their respective files.</p></li>

<li><p>Import the rulesets into immediate use:</p>

<pre><code>sudo iptables-restore &lt; /tmp/v4
sudo ip6tables-restore &lt; /tmp/v6
</code></pre></li>

<li><p>To apply your iptables rules automatically on boot, see our section on configuring <a href="/docs/security/firewalls/control-network-traffic-with-iptables#introduction-to-iptables-persistent">iptables-persistent</a>.</p></li>
</ol>

<h3 id="centos-fedora">CentOS / Fedora</h3>

<p><strong>CentOS 7 or Fedora 20 and above</strong></p>

<p>In these distros, FirewallD is used to implement firewall rules instead of using the iptables command. If you prefer to use it over iptables, see our guide: <a href="/docs/security/firewalls/introduction-to-firewalld-on-centos">Introduction to FirewallD on CentOS</a>.</p>

<ol>
<li><p>If you prefer to use iptables, FirewallD must first be stopped and disabled.</p>

<pre><code>sudo systemctl stop firewalld.service &amp;&amp; sudo systemctl disable firewalld.service
</code></pre></li>

<li><p>Install <code>iptables-services</code> and enable iptables and ip6tables:</p>

<pre><code>sudo yum install iptables-services
sudo systemctl enable iptables &amp;&amp; sudo systemctl enable ip6tables
sudo systemctl start iptables &amp;&amp; sudo systemctl start ip6tables
</code></pre></li>

<li><p>Create the files <code>/tmp/v4</code> and <code>/tmp/v6</code>. Paste the <a href="#basic-iptables-rulesets-for-ipv4-and-ipv6">rulesets above</a> into their respective files.</p></li>

<li><p>Import the rulesets into immediate use:</p>

<pre><code>sudo iptables-restore &lt; /tmp/v4
sudo ip6tables-restore &lt; /tmp/v6
</code></pre></li>

<li><p>Save each ruleset:</p>

<pre><code>sudo service iptables save
sudo service ip6tables save
</code></pre></li>

<li><p>Remove the temporary rule files:</p>

<pre><code>sudo rm /tmp/{v4,v6}
</code></pre></li>
</ol>

<p><strong>CentOS 6</strong></p>

<ol>
<li><p>Create the files <code>/tmp/v4</code> and <code>/tmp/v6</code>. Paste the <a href="#basic-iptables-rulesets-for-ipv4-and-ipv6">rulesets above</a> into their respective files.</p></li>

<li><p>Import the rules from the temporary files:</p>

<pre><code>sudo iptables-restore &lt; /tmp/v4
sudo ip6tables-restore &lt; /tmp/v6
</code></pre></li>

<li><p>Save the rules:</p>

<pre><code>sudo service iptables save
sudo service ip6tables save
</code></pre>

<blockquote class="note">
  <strong class="callout-title">Note</strong>
  <div>Firewall rules are saved to <code>/etc/sysconfig/iptables</code> and <code>/etc/sysconfig/ip6tables</code>.</div>
</blockquote>
</li>

<li><p>Remove the temporary rule files:</p>

<pre><code>sudo rm /tmp/{v4,v6}
</code></pre></li>
</ol>

<h3 id="arch-linux">Arch Linux</h3>

<ol>
<li><p>Create the files <code>/etc/iptables/iptables.rules</code> and <code>/etc/iptables/ip6tables.rules</code>. Paste the <a href="#basic-iptables-rulesets-for-ipv4-and-ipv6">rulesets above</a> into their respective files.</p></li>

<li><p>Import the rulesets into immediate use:</p>

<pre><code>sudo iptables-restore &lt; /etc/iptables/iptables.rules
sudo ip6tables-restore &lt; /etc/iptables/ip6tables.rules
</code></pre></li>

<li><p>iptables does not run by default in Arch. Enable and start the systemd units:</p>

<pre><code>sudo systemctl start iptables &amp;&amp; sudo systemctl start ip6tables
sudo systemctl enable iptables &amp;&amp; sudo systemctl enable ip6tables
</code></pre>

<p>For more info on using iptables in Arch, see its Wiki entries for <a href="https://wiki.archlinux.org/index.php/Iptables">iptables</a> and a <a href="https://wiki.archlinux.org/index.php/Simple_stateful_firewall">simple stateful firewall</a>.</p></li>
</ol>

<h3 id="verify-iptables-rulesets">Verify iptables Rulesets</h3>

<p>Check your Linode&rsquo;s firewall rules with the <code>v</code> option for a verbose output:</p>

<pre><code>sudo iptables -vL
sudo ip6tables -vL
</code></pre>

<p>The output for IPv4 rules should show:</p>

<pre><code>Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 ACCEPT     all  --  lo     any     anywhere             anywhere
    0     0 REJECT     all  --  !lo    any     loopback/8           anywhere             reject-with icmp-port-unreachable
    0     0 ACCEPT     icmp --  any    any     anywhere             anywhere             icmp destination-unreachable
    0     0 ACCEPT     icmp --  any    any     anywhere             anywhere             icmp echo-request
    0     0 ACCEPT     icmp --  any    any     anywhere             anywhere             icmp time-exceeded
    0     0 ACCEPT     tcp  --  any    any     anywhere             anywhere             tcp dpt:ssh state NEW
    0     0 ACCEPT     tcp  --  any    any     anywhere             anywhere             tcp dpt:http state NEW
    0     0 ACCEPT     tcp  --  any    any     anywhere             anywhere             tcp dpt:https state NEW
    0     0 ACCEPT     all  --  any    any     anywhere             anywhere             state RELATED,ESTABLISHED
    0     0 LOG        all  --  any    any     anywhere             anywhere             limit: avg 5/min burst 5 LOG level debug prefix &quot;iptables_INPUT_denied: &quot;
    0     0 REJECT     all  --  any    any     anywhere             anywhere             reject-with icmp-port-unreachable

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 LOG        all  --  any    any     anywhere             anywhere             limit: avg 5/min burst 5 LOG level debug prefix &quot;iptables_FORWARD_denied: &quot;
    0     0 REJECT     all  --  any    any     anywhere             anywhere             reject-with icmp-port-unreachable

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
</code></pre>

<p>Output for IPv6 rules will look like this:</p>

<pre><code>Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 ACCEPT     all      lo     any     anywhere             anywhere
    0     0 REJECT     all      !lo    any     localhost            anywhere             reject-with icmp6-port-unreachable
    0     0 ACCEPT     ipv6-icmp    any    any     anywhere             anywhere
    0     0 ACCEPT     tcp      any    any     anywhere             anywhere             tcp dpt:http state NEW
    0     0 ACCEPT     tcp      any    any     anywhere             anywhere             tcp dpt:https state NEW
    0     0 ACCEPT     all      any    any     anywhere             anywhere             state RELATED,ESTABLISHED
    0     0 LOG        all      any    any     anywhere             anywhere             limit: avg 5/min burst 5 LOG level debug prefix &quot;ip6tables_INPUT_denied: &quot;
    0     0 REJECT     all      any    any     anywhere             anywhere             reject-with icmp6-port-unreachable

Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 LOG        all      any    any     anywhere             anywhere             limit: avg 5/min burst 5 LOG level debug prefix &quot;ip6tables_FORWARD_denied: &quot;
    0     0 REJECT     all      any    any     anywhere             anywhere             reject-with icmp6-port-unreachable

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
</code></pre>

<p>Your firewall rules are now in place and protecting your Linode. Remember, you may need to edit these rules later if you install other packages that require network access.</p>

<h2 id="introduction-to-iptables-persistent">Introduction to iptables-persistent</h2>

<p>Ubuntu and Debian have a package called <strong>iptables-persistent</strong> that makes it easy to reapply your firewall rules at boot time.  After installation, you can save all your rules in two files (one for IPv4 and one for IPv6). If you&rsquo;ve already configured and applied iptables rules, iptables-persistent will detect them automatically and allow you to add them to the appropriate configuration file.</p>

<h3 id="install-iptables-persistent">Install iptables-persistent</h3>

<p>On Debian or Ubuntu use the following command to check whether <code>iptables-persistent</code> is already installed:</p>

<pre><code>dpkg -l iptables-persistent
</code></pre>

<p>If <code>dpkg</code> returns that there are no matching packages, you will need to install the <code>iptables-persistent</code> package:</p>

<pre><code>apt-get install iptables-persistent
</code></pre>

<p>During the installation, you will be prompted twice. The first prompt is asking if you would like to save your current IPv4 rules.</p>

<p><a href="/docs/assets/1721-ipv4-rules.png"><img src="/docs/assets/1721-ipv4-rules.png" alt="Save IPv4 rules prompt." /></a></p>

<p>The second prompt is to save the rules configured for IPv6.</p>

<p><a href="/docs/assets/1722-ipv6-rules.png"><img src="/docs/assets/1722-ipv6-rules.png" alt="Save IPv6 rules prompt." /></a></p>

<p>After the install is complete, you should see the iptables&rsquo;s subdirectory. Run the <code>ls /etc/iptables</code> command again to verify that your output resembles the following:</p>

<pre><code>rules.v4  rules.v6
</code></pre>

<h3 id="use-iptables-persistent">Use iptables-persistent</h3>

<p>To view what rules are already configured on your server:</p>

<pre><code>iptables -L
</code></pre>

<p>You should see output similar to:</p>

<pre><code>Chain INPUT (policy ACCEPT)
target      prot opt source         destination
DROP        all  --  198.51.100.0    anywhere

Chain FORWARD (policy ACCEPT)
target      prot opt source         destination

CHAIN OUTPUT (policy ACCEPT)
target      prot opt source         destination
</code></pre>

<p>The rules above allow anyone anywhere access to everything. If your output resembles this, you&rsquo;ll need to set rules that prevent unauthorized access.</p>

<h3 id="iptables-persistent-rules">iptables-persistent Rules</h3>

<p>Use the <code>rules.v4</code> or <code>rules.v6</code> files to add, delete or edit the rules for your server. These files can be edited using a text editor to function as a proxy, NAT or firewall. The configuration depends on the requirements of your server and what functions are needed. Below is a file excerpt from both the <code>rules.v4</code> and <code>rules.v6</code> files:</p>

<dl class="file-excerpt">
<dt>


		/etc/iptables/rules.v4 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span><span class="lnt">5</span><span class="lnt">6</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># Generated by iptables-save v1.4.14 on Wed Apr  2 13:24:27 2014
</span><span class="c1"></span>*security
:INPUT ACCEPT <span class="o">[</span><span class="m">18483</span>:1240117<span class="o">]</span>
:FORWARD ACCEPT <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
:OUTPUT ACCEPT <span class="o">[</span><span class="m">17288</span>:2887358<span class="o">]</span>
COMMIT</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<dl class="file-excerpt">
<dt>


		/etc/iptables/rules.v6 


</dt>
<dd>




<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1</span><span class="lnt">2</span><span class="lnt">3</span><span class="lnt">4</span><span class="lnt">5</span><span class="lnt">6</span><span class="lnt">7</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># Generated by ip6tables-save v1.4.14 on Wed Apr  2 13:24:27 2014
</span><span class="c1"></span>*nat
:PREROUTING ACCEPT <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
:INPUT ACCEPT <span class="o">[</span><span class="m">0</span>:0<span class="o">]</span>
:OUTPUT ACCEPT <span class="o">[</span><span class="m">27</span>:2576<span class="o">]</span>
:POSTROUTING ACCEPT <span class="o">[</span><span class="m">27</span>:2576<span class="o">]</span>
COMMIT</code></pre></td></tr></table>
</div>
</div>
</dd>
</dl>


<p>While some rules are configured in these files already, either file can be edited at any time. The syntax for altering table rules is the same as in the sections <a href="#configure-iptables">Configure iptables</a> and <a href="#use-ip6tables-to-manage-ipv6-traffic">Configuring Rules for IPv6</a>.</p>

<h3 id="save-iptables-persistent-rules-through-reboot">Save iptables-persistent Rules Through Reboot</h3>

<p>By default, iptables-persistent rules save on reboot for IPv4 only. Therefore, if you are running both IPv4 and IPv6 together you will need to manually edit both the <code>rules.v4</code> and <code>rules.v6</code> files. On older systems, <code>iptables-save</code> was used to write the changes to the <code>rules</code> file. Now that <code>iptables-persistent</code> is an option, do not use the <code>iptables-save &gt; /etc/iptables/rules.v4</code> or <code>iptables-save &gt; /etc/iptables/rules.v6</code> commands as any IPv6 changes will be overwritten by the IPv4 rules.</p>

<p>To enforce the iptables rules and ensure that they persist after reboot run <code>dpkg-reconfigure</code> and respond <strong>Yes</strong> when prompted. (If you ever edit your saved rules in the future, use this same command to save them again.)</p>

<pre><code>dpkg-reconfigure iptables-persistent
</code></pre>

<p>To verify the rules are applied and available after the system reboot use the commands:</p>

<pre><code>iptables -L
ip6tables -L
</code></pre>

<h2 id="network-lock-out">Network Lock-out</h2>

<p>When you&rsquo;re applying network rules, especially with both IPv4 and IPv6 and multiple interfaces, it is easy to lock yourself out. In the event you apply the rule and are unable to access your server, you may gain access through <a href="https://www.linode.com/docs/networking/using-the-linode-shell-lish">Lish</a> in the Linode Manager. The following steps will guide you through using the GUI interface of your Linode to gain access to your server:</p>

<ol>
<li>Connect to your Linode Manager.</li>
<li>Click on the Remote Access tab.</li>
<li>Under the section entitled &ldquo;Console Access,&rdquo; click on the <strong>Launch Lish Console</strong> link.</li>
<li>Login with your root or sudo user name and password.</li>
<li><a href="#configure-iptables">Remove any rules</a> causing the connectivity issues.</li>
<li>Log out of the Lish window.</li>
<li>Attempt login via a regular SSH session.</li>
</ol>

<p>This Lish console will function similarly to a regular SSH terminal session.</p>

<h2 id="troubleshooting-netfilter-persistent-doesn-t-come-back-up-on-reboot">Troubleshooting: netfilter-persistent doesn&rsquo;t come back up on reboot.</h2>

<p>If you have upgraded to Debian 8 from an earlier version, you may see a situation where netfilter-persistent fails to start during boot when using the Linode kernel. The console output will show similar to:</p>

<pre><code>[FAILED] Failed to start Load Kernel Modules.
See 'systemctl status systemd-modules-load.service' for details.
[DEPEND] Dependency failed for netfilter persistent configuration
</code></pre>

<p>You can also use <code>journalctl -xn</code> to see that systemd can not load the <code>loop</code> module:</p>

<pre><code>systemd-modules-load[3452]: Failed to lookup alias 'loop': Function not implemented
</code></pre>

<p>To fix this, comment out the line <code>loop</code> in <code>/etc/modules</code>:</p>

<pre><code>sed -i 's/loop/#loop/g' /etc/modules
</code></pre>

<p>Then restart netfilter-persistent:</p>

<pre><code>systemctl restart netfilter-persistent
</code></pre>

<p>It should then be running fine. Confirm with:</p>

<pre><code>systemctl status netfilter-persistent
</code></pre>

<p>This issue does not occur in new deployments of Debian 8 because the <code>loop</code> line isn&rsquo;t present in <code>/etc/modules</code>.</p>

            
<h2>More Information</h2>
<p>You may wish to consult the following resources for additional information on this topic. While these are provided in the hope that they will be useful, please note that we cannot vouch for the accuracy or timeliness of externally hosted materials.</p>
<ul>

<li><a href="/docs/security/linux-security-basics">Security Basics</a></li>

<li><a href="/docs/networking/using-the-linode-shell-lish">Using the Linode Shell (Lish)</a></li>

<li><a href="http://bencane.com/2012/09/17/iptables-linux-firewall-rules-for-a-basic-web-server/">iptables: Linux firewall rules for a basic Web Server</a></li>

<li><a href="http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch14_:_Linux_Firewalls_Using_iptables">Linux Firewalls with iptables</a></li>

</ul>


            

<h2>See Also</h2>
<ul>
    
    
    <li><a href="/docs/security/firewalls/configure-firewall-with-ufw/">How to Configure a Firewall with UFW</a></li>
    
    
    
    <li><a href="/docs/networking/vpn/configure-openvpn-access-server-to-tunnel-traffic/">How to Configure OpenVPN Access Server to Tunnel Traffic</a></li>
    
    
    
    <li><a href="/docs/security/firewalls/introduction-to-firewalld-on-centos/">Introduction to FirewallD on CentOS</a></li>
    
    
    
    <li><a href="/docs/networking/vpn/install-openvpn-access-server-on-linux/">Install OpenVPN Access Server on Linux for Secure Communications</a></li>
    
    
    
    <li><a href="/docs/networking/diagnostics/install-iperf-to-diagnose-network-speed-in-linux/">Install iPerf to Diagnose Network Speed in Linux</a></li>
    
    
</ul>


            
            
<p class="doc-license">This guide is published under a <a href="https://creativecommons.org/licenses/by-nd/4.0">CC BY-ND 4.0</a> license.</p>

          </div>
          <div id="doc-sidebar-container" class="col-sm-3 col-sm-pull-9 hidden-xs">
            <div id="doc-sidebar">
              <div markdown="0" class="doc-sidebar-inner" >
  <div class="input-group">
	<label class="sr-only" for="q">Search guides and tutorials</label>
	<input id="ss_keyword" name="q" type="text" class="form-control" placeholder="Search guides..."/>
	<span class="input-group-btn">
		<button type="submit" class="btn btn-blue" id="ds-search-btn"><span class="glyphicon glyphicon-search"></span></button>
	</span>
</div>
</div>

                
              <div class="doc-sidebar-inner" id="doc-sidebar-toc">
                <h3 id="doc-sidebar-title">In This Guide:</h3>
                <div class="sidebar sidebar-library toc-long nav navbar" id="markdown-toc">
                    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#use-linux-iptables-to-manage-ipv4-traffic">Use Linux iptables to Manage IPv4 Traffic</a>
<ul>
<li><a href="#the-iptables-command">The iptables Command</a></li>
<li><a href="#basic-iptables-parameters-and-syntax">Basic iptables Parameters and Syntax</a></li>
<li><a href="#default-tables">Default Tables</a></li>
<li><a href="#basic-iptables-options">Basic iptables Options</a></li>
<li><a href="#insert-replace-or-delete-iptables-rules">Insert, Replace or Delete iptables Rules</a></li>
<li><a href="#view-your-current-iptables-rules">View Your Current iptables Rules</a></li>
</ul></li>
<li><a href="#configure-iptables">Configure iptables</a>
<ul>
<li><a href="#block-traffic-by-port">Block Traffic by Port</a></li>
<li><a href="#drop-traffic-from-an-ip">Drop Traffic from an IP</a></li>
<li><a href="#block-or-allow-traffic-by-port-number-to-create-an-iptables-firewall">Block or Allow Traffic by Port Number to Create an iptables Firewall</a></li>
<li><a href="#whitelist-blacklist-traffic-by-address">Whitelist/Blacklist Traffic by Address</a></li>
</ul></li>
<li><a href="#use-ip6tables-to-manage-ipv6-traffic">Use ip6tables to Manage IPv6 Traffic</a>
<ul>
<li><a href="#configure-rules-for-ipv6">Configure Rules for IPv6</a></li>
<li><a href="#required-rules-for-non-static-ipv6-allocations">Required Rules for Non-Static IPv6 Allocations</a></li>
</ul></li>
<li><a href="#basic-iptables-rulesets-for-ipv4-and-ipv6">Basic iptables Rulesets for IPv4 and IPv6</a></li>
<li><a href="#deploy-your-iptables-rulesets">Deploy Your iptables Rulesets</a>
<ul>
<li><a href="#debian-ubuntu">Debian / Ubuntu</a></li>
<li><a href="#centos-fedora">CentOS / Fedora</a></li>
<li><a href="#arch-linux">Arch Linux</a></li>
<li><a href="#verify-iptables-rulesets">Verify iptables Rulesets</a></li>
</ul></li>
<li><a href="#introduction-to-iptables-persistent">Introduction to iptables-persistent</a>
<ul>
<li><a href="#install-iptables-persistent">Install iptables-persistent</a></li>
<li><a href="#use-iptables-persistent">Use iptables-persistent</a></li>
<li><a href="#iptables-persistent-rules">iptables-persistent Rules</a></li>
<li><a href="#save-iptables-persistent-rules-through-reboot">Save iptables-persistent Rules Through Reboot</a></li>
</ul></li>
<li><a href="#network-lock-out">Network Lock-out</a></li>
<li><a href="#troubleshooting-netfilter-persistent-doesn-t-come-back-up-on-reboot">Troubleshooting: netfilter-persistent doesn&rsquo;t come back up on reboot.</a></li>
</ul></li>
</ul>
</nav>
                </div>
              </div>
              
              <div class="library-rss">
  <a href="https://linode.com/docs/index.xml"><i class="fa fa-rss-square"></i> RSS feed</a>
</div>

              <div markdown="0" class="library-signup">
  <form action="//linode.us7.list-manage.com/subscribe/post?u=f9b54ed743e1629877750e3f4&amp;id=68bafea72a&SIGNUP=library-website"
    method="post" class="email-signup" target="_blank" novalidate="">
    <i class="fa fa-envelope"></i>
    <h6>Monthly Guides Update</h6>
    <input name="EMAIL" type="email" class="form-control input-sm"
    placeholder="Email address" required="" />
    <div style="position: absolute; left: -5000px;" aria-hidden="true">
      <input type="text" name="b_f9b54ed743e1629877750e3f4_68bafea72a"
      tabindex="-1" value="">
    </div>
    <div style="display:none">
      <input type="checkbox" value="4" name="group[13][4]"
      id="mce-group[13]-13-0" checked="">
    </div>
    <button type="submit" class="btn btn-blue btn-sm btn-border email-signup" value="Subscribe"
    name="subscribe" id="mc-embedded-subscribe">Sign Up</button>
  </form>
</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<div class="modal fade" id="img-modal" tabindex="-1" role="dialog" aria-labelledby="imageModal" aria-hidden="true">
  <div class="modal-dialog modal-full">
    <div class="modal-content">
      <div class="modal-header">
        <h4 id="img-modal-title" class="modal-title">Image Detail</h4>
      </div>
      <div class="modal-body">
        <img id="img-modal-image" class="img-responsive">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-blue" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

        <footer>
            <section class="neutral some-space">
	<div class="container">
		<div class="row">
			<div class="col-sm-12 text-center">
				<h3>Get paid to write for Linode.</h3>
				<p class="lead">We're always expanding our docs. If you like to help people, can write, and want to earn some cash, learn how you can <a href="/docs/contribute">earn up to $300 for every guide you write</a> and we publish.</p>
			</div>
		</div>
	</div>
</section>
            <section id="pre-footer">
  <div class="container">
    <div class="row">
      <div class="col-sm-7">
        <span>Get started in the Linode Cloud today.</span>
      </div>
      <div class="col-sm-5 pad-xs">
        <a id="btn-signup-bottom" class="btn btn-lg btn-full btn-green" href="https://manager.linode.com/session/signup">Create an Account</a>
      </div>
    </div>
  </div>
</section>

<section class="dark">
  <div class="container">

    <div class="row">
      <div class="footer-col">
        <h5><a href="https://www.linode.com/linodes">Overview</a></h5>
        <ul>
          <li><a href="https://www.linode.com/pricing">Plans &amp; Pricing</a></li>
          <li><a href="https://www.linode.com/linodes">Features</a></li>
          <li><a href="https://www.linode.com/addons">Add-Ons</a></li>
          <li><a href="https://www.linode.com/managed">Managed</a></li>
          <li><a href="https://www.linode.com/professional-services">Professional Services</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h5><a href="https://linode.com/docs/">Resources</a></h5>
        <ul>
          <li><a href="https://linode.com/docs/">Guides &amp; Tutorials</a></li>
          <li><a href="https://www.linode.com/speedtest">Speed Test</a></li>
          <li><a href="https://forum.linode.com/">Forum</a></li>
          <li><a href="https://www.linode.com/chat">Chat</a></li>
          <li><a href="http://status.linode.com/">System Status</a></li>
        </ul>
      </div>


      <div class="footer-col">
        <h5><a href="https://www.linode.com/about">Company</a></h5>
        <ul>
          <li><a href="https://www.linode.com/about">About Us</a></li>
          <li><a href="https://blog.linode.com">Blog</a></li>
          <li><a href="https://www.linode.com/press">Press</a></li>
          <li><a href="https://www.linode.com/referrals">Referral System</a></li>
          <li><a href="https://www.linode.com/careers">Careers</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h5><a href="https://www.linode.com/contact">Contact Us</a></h5>
        <ul>
          <li><a href="tel:+18554546633">855-4-LINODE</a></li>
          <li><a href="tel:+18554546633">(855-454-6633)</a></li>
          <li><a href="tel:+16093807100">Intl.: +1 609-380-7100</a></li>
          <li><a href="mailto:support@linode.com">Email us</a></li>
          <li>
            <br />
            <a target="_blank" href="https://facebook.com/linode"><i class="fa fa-facebook-square"></i></a>
            <a target="_blank" href="https://twitter.com/linode"><i class="fa fa-twitter-square"></i></a>
            <a target="_blank" href="https://plus.google.com/+linode/"><i class="fa fa-google-plus-square"></i></a>
            <a target="_blank" href="https://linkedin.com/company/linode"><i class="fa fa-linkedin-square"></i></a>
            <a target="_blank" href="https://github.com/linode/"><i class="fa fa-github-square"></i></a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</section>

<section class="dark-moar">
  <div class="container">
    <div id="footer-copyright" class="row">
      <div class="col text-center">
        &copy; 2017 Linode, LLC
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/tos">Terms of Service</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/privacy">Privacy Policy</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/security">Security</a>
      </div>

      <div class="col text-center">
        <a href="https://www.linode.com/compliance">Standards &amp; Compliance</a>
      </div>
    </div>
  </div>
</section>

        </footer>
        
             <script src="/docs/build/js/libs.js" type="text/javascript"></script>
<script src="/docs/build/js/main.js" type="text/javascript"></script>

        
        <script type="text/javascript">
$( "img[src^='\/docs\/assets']" ).each(function () {
  $( this ).parent().bind('click', false);
  $( this ).on('click', function(e) {
    var image_title = $( this ).attr('alt');
    var image_href = $( this ).parent().attr('href') || $( this ).attr('src');
    $( '#img-modal-image' ).attr('src', image_href);
    $( '#img-modal-title' ).text(image_title);
    $( '#img-modal' ).modal({ show: true });
  });
});
</script>



        
<script type="text/javascript">
 SidebarScroll.init()
</script>

    </body>
</html>